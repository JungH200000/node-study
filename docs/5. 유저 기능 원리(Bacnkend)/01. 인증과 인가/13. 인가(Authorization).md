## 로그인은 했는데... '권한이 없습니다'? 인가(Authorization) 완벽 이해 👮‍♂️

'사용자 기능'의 두 번째 핵심 축, **인가(Authorization)** 에 대해 알아볼 시간입니다. 많은 사람이 두 용어를 혼용하지만, '인증'과 '인가'는 명백히 다른 두 단계의 작업입니다.

### 🕵️‍♂️ 인증 vs. 인가, 다시 한번 짚고 가기

> **콘서트장 비유를 다시 떠올려 볼까요?** 🎟️
>
> - **인증 (Authentication)**: "당신이 누구인가?"
>   콘서트장 입구에서 신분증을 확인하여 **티켓 소유자 본인이 맞는지 확인**하는 과정입니다.
> - **인가 (Authorization)**: "당신이 무엇을 할 수 있는가?"
>   신원 확인이 끝난 관객이 VIP 라운지에 들어가려 할 때, **VIP 티켓을 가졌는지 확인하여 출입을 허가**하는 과정입니다.

이처럼, 인가는 **성공적으로 인증된 사용자가 특정 행동을 할 수 있는 권한을 가지고 있는지 확인**하는 절차입니다.

---

### 인가는 어떻게 동작할까요? (인스타그램 게시글 삭제 예시)

인스타그램에서 오직 **게시글 작성자** 또는 **서비스 관리자**만이 게시글을 삭제할 수 있는 상황을 가정해 봅시다.

1.  **요청 접수**: 서버가 특정 게시글에 대한 '삭제' 요청을 받습니다.
2.  **(1단계) 인증**: 서버는 요청에 함께 실려온 토큰이나 세션 ID를 통해 **"이 요청을 보낸 사람이 누구인지"** 를 먼저 확인합니다.
    - 만약 인증 정보가 없거나 유효하지 않다면, 여기서 즉시 요청을 거부합니다. (→ `401 Unauthorized` 응답)
3.  **(2단계) 인가**: 성공적으로 사용자의 신원(`request.user`)이 확인되면, 서버는 이제 **"이 사용자가 이 게시글을 삭제할 권한이 있는지"** 를 확인합니다.
    - `if request.user is admin or post.user:` (요청을 보낸 사용자가 관리자이거나, 이 게시글의 작성자인가?)
4.  **처리 결정**:
    - **인가 성공**: 권한이 확인되면, 서버는 요청대로 게시글을 삭제하고 '성공' 응답을 보냅니다.
    - **인가 실패**: 권한이 없다면, 서버는 게시글을 삭제하지 않고 "당신은 이 작업을 수행할 권한이 없습니다"라는 의미의 '실패' 응답을 보냅니다. (→ `403 Forbidden` 응답)

---

### 나만의 '규칙'을 코드로 옮기기

인가 로직을 구현하는 것은 결국, 우리가 기획한 **서비스의 규칙(정책)을 코드로 옮기는 과정**입니다.

#### **1단계: 서비스 정책(Policy) 정하기**

먼저 우리 서비스에 필요한 다양한 권한 규칙을 명확하게 정의해야 합니다.

- **예시 정책**
  - 관리자 또는 게시글 주인만 게시글을 삭제할 수 있다.
  - 게시글 주인의 '친구'가 아니면 게시글을 볼 수 없다.
  - 사용자 등급이 '새싹' 등급이면 댓글을 작성할 수 없다.

#### **2단계: 정책을 코드로 구현하기**

그다음, 정의된 정책을 서버 코드의 조건문(`if`)을 사용하여 그대로 구현합니다.

- **의사 코드(Pseudo-code) 예시**

  ```python
  # 정책: 관리자 또는 게시글 주인만 게시글을 삭제할 수 있다.
  if request.user.is_admin or request.user == post.author:
    post.delete()
  else:
    return response(status=403, message="삭제 권한이 없습니다.")
  ```

  ```python
  # 정책: '새싹' 등급은 댓글 작성이 불가능하다.
  if request.user.rank == "새싹":
    return response(status=403, message="새싹 등급은 댓글을 작성할 수 없습니다.")
  ```

규칙의 복잡도에 따라 다르겠지만, 대부분의 인가 로직은 이처럼 간단한 조건문만으로도 충분히 구현할 수 있습니다.

---

### ✍️ 마무리하며

- **인가(Authorization)** 는 **인증(Authentication)** 을 통과한 사용자가 **특정 리소스에 접근하거나 특정 행동을 할 수 있는 권한이 있는지** 확인하는 과정입니다.
- "이 사람이 누구인가?"를 확인하는 것이 인증이라면, "그래서 이 사람이 뭘 할 수 있는데?"를 확인하는 것이 인가입니다.
- 인가 로직을 구현하는 것은, 서비스의 **'정책'** 을 정하고 그것을 코드의 **'조건문'** 으로 옮기는 과정과 같습니다.
- 성공적인 인증 뒤에 올바른 인가 절차를 구현하는 것이야말로, 안전하고 신뢰할 수 있는 시스템을 만드는 핵심입니다.
