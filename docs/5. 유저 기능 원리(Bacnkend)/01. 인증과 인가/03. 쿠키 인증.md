## 로그인 상태 유지의 비밀 1편: 쿠키 인증(Cookie-based Authentication) 🍪

지난 글에서 우리는 로그인이 성공하면 서버가 클라이언트에게 특별한 **'출입증'** 을 발급해주고, 클라이언트는 이 출입증을 이용해 로그인 상태를 유지한다고 배웠습니다.

이번 글에서는 클라이언트가 이 '출입증'을 서버와 주고받는 대표적인 방법 중 하나인 **쿠키(Cookie) 인증 방식**에 대해 알아보겠습니다.

---

### 쿠키(Cookie)란 무엇일까요?

**쿠키**는 서버가 보내주는 정보를 웹 브라우저에 저장하기 위한 작은 텍스트 조각입니다. 마치 레스토랑에서 외투를 맡기고 받는 **'보관증'** 과 같다고 생각할 수 있습니다.

이 보관증(쿠키) 안에는 여러 정보가 하나의 문자열로 담겨 있으며, 각 정보는 세미콜론(`;`)으로 구분됩니다.

- **이름(Name)과 값(Value)**: 쿠키의 핵심 정보입니다. `certificate=8e9z00qq3`처럼 이름과 값이 쌍을 이룹니다. (예: 보관증 번호)
- **속성(Attributes)**: 쿠키의 동작을 제어하는 추가 설정입니다. (예: 보관증의 유효기간, 사용 규칙 등)

---

### 쿠키 인증은 어떻게 동작할까요? (단계별 흐름)

#### **1단계: 서버의 '보관증' 발급 (`Set-Cookie` 헤더)**

사용자가 아이디와 비밀번호로 성공적으로 로그인하면, 서버는 응답(Response) 헤더에 `Set-Cookie`라는 특별한 헤더를 담아 '보관증'을 발급합니다.

```http
HTTP/1.1 200 OK
Content-Type: application/json
Set-Cookie: certificate=8e9z00qq3; Expires=Fri, 10 Oct 2025 23:59:59 GMT; SameSite=Strict; Secure; HttpOnly

{
  "message": "로그인에 성공했습니다."
}
```

- **`Expires`**: 쿠키의 만료 날짜를 지정합니다. 이 날짜가 지나면 쿠키는 자동으로 삭제됩니다.
- **`SameSite`**: 다른 도메인에서 요청이 올 때 쿠키 전송을 어떻게 제한할지 정하는 보안 설정입니다. `Strict`는 가장 엄격한 옵션입니다.
- **`Secure`**: `HTTPS` 프로토콜을 사용하는 보안 연결에서만 쿠키가 전송되도록 합니다.
- **`HttpOnly`**: 자바스크립트 코드로 쿠키에 접근할 수 없도록 막아 보안을 강화합니다.

---

#### **2단계: 브라우저의 '보관증' 자동 보관 및 제시 (`Cookie` 헤더)**

클라이언트(웹 브라우저)는 서버로부터 `Set-Cookie` 헤더가 포함된 응답을 받으면, 그 내용을 **자동으로 브라우저 내 안전한 공간에 저장**합니다.

그리고 가장 편리한 점은, 이후 **같은 웹사이트에 요청을 보낼 때마다 브라우저가 알아서 `Cookie`라는 헤더에 이 보관증을 담아 보낸다**는 것입니다.

```http
DELETE http://web.myowebsite.com/documents/45/
Cookie: certificate=8e9z00qq3
```

개발자가 별도의 코드를 작성하지 않아도, 브라우저가 이 모든 과정을 자동으로 처리해줍니다. 서버는 요청이 올 때마다 `Cookie` 헤더를 확인하고, 그 안에 담긴 '보관증'을 통해 "아, 이 요청은 로그인을 했던 바로 그 사용자가 보낸 것이구나\!" 하고 즉시 알아차릴 수 있습니다.

---

### 쿠키는 아무에게나 주지 않아요 (쿠키의 동작 범위)

브라우저에 저장된 모든 쿠키가 아무 요청에나 첨부되는 것은 아닙니다. 쿠키는 **처음 발급받았던 웹사이트(도메인)에 요청을 보낼 때만** 함께 전송됩니다.

예를 들어, 인스타그램에서 발급받은 쿠키는 인스타그램에 요청을 보낼 때만 사용되며, 구글에 요청을 보낼 때는 전송되지 않습니다. 이는 서비스 간의 정보가 섞이지 않도록 하는 중요한 규칙입니다.

---

### ✍️ 마무리하며 (쿠키 인증의 특징)

- **쿠키 인증**은 서버가 `Set-Cookie` 응답 헤더로 인증 정보를 보내면, 브라우저가 이를 저장했다가 후속 요청 시 `Cookie` 요청 헤더에 **자동으로** 담아 보내는 방식입니다.
- 이 '자동화' 덕분에 **클라이언트 측 개발이 매우 편리하다는 큰 장점**이 있습니다.
- `HttpOnly`, `Secure`, `SameSite`와 같은 다양한 보안 속성을 통해 쿠키를 더 안전하게 관리할 수 있습니다.
