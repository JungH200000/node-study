## 서버가 당신을 기억하지 않아도 괜찮아: 토큰 기반 인증 (JWT) 🎟️

안녕하세요\! 이번 글에서는 사용자 인증 방식의 또 다른 한 축인 **토큰(Token) 기반 인증**에 대해 알아보겠습니다. 이름에서 알 수 있듯, '인증 토큰'이라는 특별한 입장권을 사용해서 사용자를 파악하는 방식입니다.

---

### 토큰(Token)이란? 정보가 담긴 '암호화된 입장권'

**인증 토큰**은 사용자의 정보가 담겨있는 **암호화된 문자열**입니다. 이 토큰만 있으면 사용자가 특정 기능이나 콘텐츠에 접근(Access)할 수 있기 때문에 **엑세스 토큰(Access Token)** 이라고도 부릅니다.

> **콘서트장의 '암호화된 입장권'을 상상해 보세요\! 🎫**
>
> - **토큰 데이터**: 입장권에 적힌 정보 (좌석 번호, 공연 날짜 등)
> - **비밀키 (Secret Key)**: 주최 측만 아는 특수 잉크
> - **암호화/서명**: 특수 잉크로 입장권을 인쇄하는 과정
> - **토큰 검증**: 직원이 특수 UV 라이트(비밀키)를 비춰보고 잉크가 빛나면 '진짜 티켓'이라고 믿는 과정

이 방식의 가장 큰 특징은, 서버가 '손님 기록부'(세션)를 보관할 필요가 없다는 것입니다. 서버는 클라이언트가 가져온 '입장권(토큰)' 자체의 위조 여부만 확인하면 되기 때문입니다. 이를 **'무상태(Stateless)'** 라고 하며, 토큰 기반 인증의 핵심적인 장점입니다.

오늘날 가장 널리 사용되는 토큰 형식은 **JWT(JSON Web Token)** 입니다.

---

### 토큰은 어떻게 만들어지고, 어떻게 믿을 수 있을까? (비밀키와 서명)

사용자가 성공적으로 로그인하면, 서버는 토큰을 만들어 발급합니다.

1.  서버는 토큰에 담고 싶은 정보(예: `사용자 ID: 123`, `만료일: 2025-09-30`)를 정합니다.
2.  **서버만 알고 있는 아주 긴 비밀 문자열(비밀키, Secret Key)** 을 사용하여 이 정보에 전자 서명을 하거나 암호화합니다.
3.  이 과정을 거치면 누구도 해독할 수 없는 긴 토큰 문자열이 만들어집니다.

이 비밀키를 모르면 누구도 토큰을 위조하거나 내용을 변경할 수 없습니다. 따라서 이 비밀키는 서버 외부로 절대 유출되어서는 안 됩니다.

---

### 토큰 기반 인증은 어떻게 동작할까요? (단계별 흐름)

#### **1단계: 로그인 & 암호화된 입장권 발급**

사용자가 로그인에 성공하면, 서버는 위에서 설명한 방식으로 토큰을 생성하여 **응답 본문(Body)에 담아** 클라이언트에게 전달합니다.

#### **2단계: 클라이언트의 입장권 보관**

클라이언트는 전달받은 토큰을 쿠키가 아닌 **로컬 스토리지(Local Storage)** 와 같은 브라우저 저장 공간에 **직접 저장**합니다.

#### **3단계: 입장권 제시 (`Authorization: Bearer` 헤더)**

이후 클라이언트는 인증이 필요한 요청을 보낼 때마다, 저장해 둔 토큰을 꺼내 **`Authorization` 요청 헤더**에 담아 보냅니다. 이때 **`Bearer`** 라는 접두사를 붙이는 것이 일반적인 규칙입니다.

```http
GET https://example.com/members/3
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOjEyMywiaWF0IjoxNjc...
```

`Authorization: Bearer <토큰>`은 **"이 토큰을 소지한(Bearer) 사람에게는 접근을 허용하라"** 는 의미의 표준입니다.

#### **4. 서버의 입장권 검증**

서버는 요청 헤더로 들어온 토큰을 자신의 비밀키로 복호화하거나 서명을 검증합니다. 검증에 성공하면 토큰 안에 담겨있던 사용자 정보를 신뢰하고 요청을 처리합니다. 만약 토큰이 위조되었거나 만료되었다면, 서버는 에러로 응답합니다.

---

### 로그아웃은 어떻게 할까?

서버는 사용자의 로그인 상태를 저장하고 있지 않기 때문에, 로그아웃은 매우 간단합니다. **클라이언트 측에서 저장하고 있던 토큰을 삭제**하기만 하면 됩니다. 입장권을 찢어서 버리는 것과 같죠. 토큰이 없어진 클라이언트는 더 이상 인증이 필요한 요청을 보낼 수 없게 됩니다.

---

### ✍️ 마무리하며 (토큰 인증의 특징)

- 토큰 기반 인증의 핵심은 서버가 로그인 상태를 저장하지 않는 **무상태(Stateless) 구조**라는 점입니다.
- 모든 인증 정보는 **토큰 자체에 암호화**되어 담겨있으며, 서버는 비밀키를 통해 이 토큰의 유효성만 검증합니다.
- 클라이언트는 토큰을 직접 저장하고(`로컬 스토리지` 등), 요청 시마다 `Authorization: Bearer` 헤더에 담아 전송해야 합니다.
- **로그아웃**은 클라이언트가 저장된 토큰을 삭제하는 것으로 간단하게 처리됩니다.
- 이 방식은 서버의 확장성이 매우 뛰어나고, 웹, 모바일 앱 등 다양한 클라이언트 환경을 지원하는 데 유리하여 현대적인 API에서 널리 사용됩니다.
