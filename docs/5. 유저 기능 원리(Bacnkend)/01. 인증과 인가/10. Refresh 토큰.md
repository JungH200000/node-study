## 로그인을 계속 유지하는 가장 안전한 방법: 리프레시 토큰(Refresh Token) 🔄

액세스 토큰(Access Token)만으로 인증을 처리할 경우, 우리는 한 가지 딜레마에 빠지게 됩니다.

- **토큰 만료 기간을 길게 잡으면?**
  만약 토큰이 해커에게 탈취당했을 때, 해커가 오랫동안 사용자인 척하며 시스템에 접근할 수 있어 위험합니다.

- **토큰 만료 기간을 짧게 잡으면?**
  사용자가 너무 자주 이메일과 비밀번호를 입력하여 다시 로그인해야 하므로 불편하고, 민감한 정보가 네트워크를 통해 자주 오고 가는 것 역시 보안상 좋지 않습니다.

이 딜레마를 해결하기 위해 등장한 것이 바로 **리프레시 토큰(Refresh Token)** 입니다.

---

### 해결사 등판! 리프레시 토큰(Refresh Token)이란?

> **놀이공원 자유이용권에 비유해 볼까요? 🎡**
>
> - **액세스 토큰 (Access Token)**: 놀이기구를 탈 때마다 보여주는 **'당일 손목띠'** 와 같습니다. 유효기간이 짧고(예: 15분), 자주 사용됩니다.
> - **리프레시 토큰 (Refresh Token)**: 손목띠가 만료되었을 때, 매표소에 가서 새로운 손목띠를 재발급받기 위해 사용하는 **'연간 회원권'** 과 같습니다. 유효기간이 길고(예: 7일), 꼭 필요할 때만 사용됩니다.

이처럼 **리프레시 토큰**은, 만료된 액세스 토큰을 재발급받기 위해 사용하는 **특별한 용도의 토큰**입니다. 사용자는 귀찮게 이메일과 비밀번호를 다시 입력할 필요 없이, 이 리프레시 토큰만으로 새로운 액세스 토큰을 얻을 수 있습니다.

---

### 리프레시 토큰은 어떻게 동작할까요? (단계별 흐름)

1.  **최초 로그인**
    사용자가 이메일과 비밀번호로 성공적으로 로그인하면, 서버는 **`액세스 토큰`** 과 **`리프레시 토큰`**, 이렇게 **두 가지 토큰을 모두** 발급하여 클라이언트에게 전달합니다.

2.  **API 요청 (액세스 토큰 사용)**
    클라이언트는 일반적인 API를 요청할 때는 유효기간이 짧은 **`액세스 토큰`** 을 `Authorization` 헤더에 담아 보냅니다.

3.  **액세스 토큰 만료**
    시간이 지나 `액세스 토큰`이 만료되면, API 서버는 더 이상 요청을 받아주지 않고 `401 Unauthorized`와 같은 에러를 응답합니다.

4.  **새로운 액세스 토큰 발급 요청 (리프레시 토큰 사용)**
    `액세스 토큰`이 만료된 것을 확인한 클라이언트는, 이번에는 **`리프레시 토큰`** 을 담아 토큰 재발급을 위한 특별한 API 주소로 요청(`POST /token/refresh`)을 보냅니다.

5.  **새로운 토큰 발급**
    서버는 전달받은 `리프레시 토큰`이 유효한지 확인한 후, 문제가 없다면 **새로운 `액세스 토큰`을 발급**하여 클라이언트에게 전달해줍니다. 클라이언트는 이제 이 새로운 '당일 손목띠'를 가지고 다시 API를 사용할 수 있게 됩니다.

---

### 왜 이렇게 복잡한 방식을 사용할까요? (장점)

- **향상된 보안**: 공격자가 통신 중간에 `액세스 토큰`을 가로채더라도, 짧은 시간(예: 15분)만 유효하므로 피해를 최소화할 수 있습니다. 반면, 훨씬 더 중요하고 오래가는 `리프레시 토큰`은 토큰을 재발급받을 때만 사용되므로 네트워크상에 노출될 확률이 현저히 줄어듭니다.

- **향상된 사용자 경험**: `액세스 토큰`이 자주 만료되더라도, 그 재발급 과정은 백그라운드에서 자동으로 이루어집니다. 따라서 사용자는 `리프레시 토큰`의 유효기간(예: 7일) 동안은 비밀번호를 다시 입력할 필요 없이 계속해서 로그인 상태를 편리하게 유지할 수 있습니다.

- **민감 정보 노출 최소화**: 사용자의 실제 이메일과 비밀번호는 맨 처음 로그인할 때 단 한 번만 전송되므로, 네트워크상에서 민감한 정보가 유출될 위험을 크게 줄일 수 있습니다.

---

### ✍️ 마무리하며

- **리프레시 토큰**은 만료된 **액세스 토큰**을 재발급받기 위한 전용 토큰입니다.
- `액세스 토큰`은 **짧은 유효기간**을, `리프레시 토큰`은 **긴 유효기간**을 가집니다.
- 자주 사용하는 `액세스 토큰`의 유효기간을 짧게 만들어 **보안성**을 높이고, `리프레시 토큰`을 통해 재로그인 없이도 인증을 연장하여 **사용자 편의성**을 동시에 확보할 수 있습니다.
- 이러한 **액세스 토큰 + 리프레시 토큰** 조합은 현대적인 인증 시스템에서 가장 널리 사용되는 표준적인 방식입니다.
