## 🛋️ 세션(Session)이란? 서버의 '손님 기록부'

**세션(Session)** 은 아주 쉽게 말해, **서버 측에 저장되는 손님(방문자)에 대한 기록**입니다. 웹사이트에 방문자가 생길 때마다, 서버는 자신만 볼 수 있는 '손님 기록부'에 새로운 페이지를 만들어 방문자에 대한 정보를 기록하기 시작합니다.

서버의 세션 저장소(기록부)는 아래 표와 같은 모습일 수 있습니다. 각 방문자는 고유한 `id`(세션 ID)를 가지며, 접속 정보(`ip_address`, `user_agent` 등)가 함께 기록됩니다.

| id  | ip_address   | last_activity  | user_agent | user_id |
| :-- | :----------- | :------------- | :--------- | :------ |
| 27  | 172.16.xxx.x | 2022.06.12 ... | Chrome     | 152     |
| 28  | 199.25.xxx.x | 2023.04.30 ... | Safari     | NULL    |
| 29  | 71.241.xxx.x | 2021.12.31 ... | Chrome     | NULL    |
| 30  | 181.42.xxx.x | 2022.08.30 ... | Edge       | 214     |

여기서 가장 중요한 부분은 `user_id`입니다. 아직 로그인하지 않은 방문자(ID 28, 29)는 `user_id`가 비어있지만(`NULL`), 로그인을 완료한 사용자(ID 27, 30)는 해당 세션에 실제 사용자 계정 ID가 연결됩니다.

---

### 세션 기반 인증은 어떻게 동작할까요? (단계별 흐름)

#### 1. 첫 만남 & 손님 등록 (세션 생성)

사용자가 웹사이트에 처음 방문하여 요청을 보내면, 서버는 이 사용자를 위한 고유한 **세션 객체**를 '손님 기록부'에 새로 만듭니다. (위 표에서 28번, 29번과 같은 상태)

#### 2. 번호표 발급 (세션 ID 쿠키 전송)

서버는 생성된 세션의 고유 ID(`Session ID`)를 **`Set-Cookie` 응답 헤더**에 담아 클라이언트에게 전달합니다. 클라이언트(브라우저)는 이 쿠키를 자동으로 저장합니다. 이 쿠키는 손님에게 나눠준 '번호표'와 같습니다.

#### 3. 재방문 & 로그인 (세션 정보 업데이트)

- 사용자가 사이트를 다시 방문할 때, 브라우저는 저장해 둔 **세션 ID 쿠키('번호표')** 를 모든 요청에 자동으로 포함하여 보냅니다.
- 서버는 이 세션 ID를 보고 자신의 '손님 기록부'(세션 저장소)를 뒤져 해당 사용자를 식별합니다.
- 사용자가 성공적으로 로그인하면, 서버는 해당 세션 기록에 **사용자의 고유 정보(예: `userId: 152`)를 추가**합니다. 이제 이 세션은 '익명 손님'이 아닌 '로그인한 회원'의 세션이 됩니다.

#### 4. 인증 상태 유지

로그인 이후의 모든 요청에 대해, 서버는 쿠키로 전달된 세션 ID를 확인하고, 그에 연결된 사용자 정보를 찾아 "아, 이 요청은 152번 회원이 보낸 거구나!" 하고 인증을 완료합니다.

---

### 세션은 영원하지 않아요 (세션 만료)

한 번 로그인했다고 해서 세션이 영원히 유지되는 것은 아닙니다.

- **시간 초과**: 사용자가 일정 시간 동안 아무런 활동이 없으면, 서버는 보안을 위해 해당 세션을 자동으로 파기합니다.
- **로그아웃**: 사용자가 직접 로그아웃 버튼을 누르면, 서버는 해당 세션 정보를 삭제하여 인증을 무효화합니다.

이렇게 세션이 만료되면, 클라이언트가 기존의 세션 ID를 보내더라도 서버의 기록부에는 더 이상 정보가 없으므로 인증이 실패하게 됩니다. 이것이 바로 우리가 "세션이 만료되었습니다"라는 메시지를 보고 다시 로그인해야 하는 이유입니다.

---

### ✍️ 마무리하며 (세션 인증의 특징)

- 세션 기반 인증의 핵심은 **사용자의 상태 정보를 서버가 직접 저장하고 관리**한다는 것입니다.
- 클라이언트는 단지 서버가 발급해준 **식별표(세션 ID)를 쿠키에 담아** 가지고 다니기만 하면 됩니다.
- 서버는 클라이언트가 보내온 세션 ID를 통해 자신의 저장소에서 실제 사용자 정보를 찾아 인증을 처리합니다.
- 이 방식은 서버에 부담이 갈 수 있지만, 중요한 인증 정보를 서버에만 보관하므로 특정 상황에서는 더 안전한 구조로 여겨지기도 합니다.
