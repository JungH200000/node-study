## 열어볼 순 있지만 위조는 불가능한 '전자 서명 신분증', JWT

토큰 기반 인증 방식에서 현재 가장 널리 사용되는 표준 기술은 바로 **JWT(JSON Web Token)** 입니다. 이번 글에서는 JWT가 어떤 구조로 이루어져 있고, 어떻게 신뢰성을 보장하는지 자세히 알아보겠습니다.

---

### JWT(JSON Web Token)란 무엇일까요?

JWT는 이름 그대로, **JSON 형식의 데이터를 담고 있는 웹 토큰**입니다. 이 정보들은 Base64URL 인코딩을 통해 안전한 문자열로 변환됩니다.

- **JWT 예시**
  ```
  eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ.SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c
  ```

언뜻 보면 의미 없는 긴 문자열 같지만, 자세히 보면 마침표(`.`)를 기준으로 **세 부분**으로 나뉘어 있는 것을 알 수 있습니다.

> **[ `HEADER` ] . [ `PAYLOAD` ] . [ `SIGNATURE` ]**

각 부분이 어떤 역할을 하는지 하나씩 살펴보겠습니다.

---

### JWT의 구조: 세 조각으로 나눠보기

#### **1. 헤더 (Header): "이 토큰은 어떻게 만들어졌나요?"**

헤더는 토큰 자체에 대한 기본 정보를 담고 있습니다.

- **`typ` (Type)**: 토큰의 타입을 나타냅니다. 보통 `JWT`입니다.
- **`alg` (Algorithm)**: 토큰을 검증할 때 사용할 암호화 알고리즘을 나타냅니다. (예: `HS256`)

이 JSON 객체를 Base64URL로 인코딩한 것이 JWT의 첫 번째 부분입니다.

- **디코딩된 헤더 예시**
  ```json
  {
    "alg": "HS256",
    "typ": "JWT"
  }
  ```

---

#### **2. 페이로드 (Payload): "이 토큰은 어떤 정보를 담고 있나요?"**

페이로드는 토큰이 실질적으로 전달하고자 하는 **데이터**를 담고 있습니다. 이 데이터 조각 하나하나를 **클레임(Claim)** 이라고 부릅니다.

- **디코딩된 페이로드 예시**
  ```json
  {
    "sub": "1234567890",
    "name": "John Doe",
    "iat": 1516239022
  }
  ```

페이로드에는 어떤 정보든 담을 수 있지만, 토큰의 길이가 너무 길어지지 않도록 간결하게 구성하는 것이 좋습니다. 또한, 이름이 미리 정해진 **'등록된 클레임(Registered Claims)'** 을 사용하는 것이 권장됩니다.

- **`iss`** (Issuer): 토큰 발급자
- **`sub`** (Subject): 토큰 제목 (주로 사용자를 식별하는 고유 ID)
- **`exp`** (Expiration Time): 토큰 만료 시간
- **`iat`** (Issued At): 토큰 발급 시간

이 페이로드 JSON 객체를 Base64URL로 인코딩한 것이 JWT의 두 번째 부분입니다.

---

#### **3. 서명 (Signature): "이 토큰이 진짜임을 증명합니다."**

서명은 이 토큰이 **위조되거나 변조되지 않았음**을 증명하는, JWT의 가장 핵심적인 부분입니다.

> **마치 편지 봉투의 '밀랍 봉인'과 같아요\! ✉️**
>
> 편지의 내용물(헤더, 페이로드)은 불빛에 비춰보면 읽을 수 있지만, 왕의 인장이 찍힌 밀랍 봉인(서명)이 훼손되지 않았다면 우리는 두 가지를 확신할 수 있습니다.
>
> 1.  이 편지는 정말 왕이 보낸 것이 맞다. (**인증**)
> 2.  중간에 누군가 편지를 열어보지 않았다. (**무결성**)

서명은 다음과 같은 방식으로 만들어지고 검증됩니다.

- **생성**: 서버는 `인코딩된 헤더`와 `인코딩된 페이로드`를 합친 뒤, **서버만 알고 있는 `비밀키`** 를 사용하여 헤더에 명시된 알고리즘(`HS256`)으로 암호화합니다. 이 결과물이 바로 서명입니다.
- **검증**: 클라이언트로부터 JWT를 받은 서버는, 전달받은 헤더와 페이로드를 이용해 **똑같은 방식으로 서명을 다시 만들어 봅니다.** 그리고 직접 만든 서명과 토큰에 담겨온 서명이 일치하는지 비교합니다. 만약 두 값이 일치하지 않는다면, "누군가 토큰을 위조했구나\!"라고 판단하고 해당 요청을 거부합니다.

비밀키를 모르면 올바른 서명을 절대 만들어낼 수 없기 때문에, 누군가 중간에 토큰을 가로채 페이로드의 내용을 바꾸더라도 서명 검증 단계에서 모두 걸러낼 수 있습니다.

---

### ⚠️ 가장 중요한 주의사항: 비밀번호를 넣지 마세요\!

JWT의 헤더와 페이로드는 암호화가 아닌 **인코딩**된 것입니다. 인코딩은 누구나 쉽게 원래의 정보로 디코딩해서 내용을 들여다볼 수 있습니다.

따라서 페이로드에는 사용자의 ID, 역할, 만료 시간 등 기본적인 정보만 담고, **절대로 비밀번호와 같은 민감한 개인 정보를 담아서는 안 됩니다.**

---

### ✍️ 마무리하며

- **JWT**는 **헤더, 페이로드, 서명** 세 부분으로 구성된 표준 토큰 형식입니다.
- **헤더**와 **페이로드**는 토큰의 정보와 데이터를 담고 있으며, 누구나 디코딩하여 내용을 볼 수 있습니다.
- **서명**은 서버의 `비밀키`로 암호화되어, 토큰의 **인증(Authentication)** 과 **무결성(Integrity)** 을 보장하는 핵심적인 역할을 합니다.
- 이러한 '자기 완결적인' 구조 덕분에, 서버는 별도의 세션을 유지할 필요 없이 토큰만으로 사용자를 신뢰하고 인증할 수 있습니다.
