## 소셜 로그인 완전 정복: OAuth를 넘어 OpenID Connect(OIDC)까지

우리는 이전 글에서 OAuth가 '권한 위임'을 위한 표준이라고 배웠습니다. 그런데 우리가 흔히 보는 '구글로 로그인하기', '카카오로 로그인하기'와 같은 **소셜 로그인**은 단순히 다른 서비스의 데이터에 접근하는 것을 넘어, **사용자의 신원을 확인하는 '인증'** 까지 포함합니다.

OAuth는 접근 권한은 주지만, "그래서 로그인한 사용자가 정확히 누구인가?"에 대한 표준화된 답변을 주지는 않습니다. 바로 이 부족한 2%를 채워주는 것이 **OpenID Connect(OIDC)** 입니다.

---

### OIDC란? OAuth 위에 세운 '인증' 레이어

**OIDC(OpenID Connect)** 는 **OAuth 2.0 프로토콜 위에 구축된 간단한 ID 계층(Identity Layer)** 입니다. 쉽게 말해, OAuth의 '권한 위임' 흐름을 그대로 활용하되, 마지막에 **사용자의 신원 정보가 담긴 '신분증'을 추가로 발급**해주는 표준 규격이죠.

따라서 OIDC를 따른다는 것은 자동으로 OAuth 2.0을 따른다는 의미이기도 합니다.

### OIDC의 주인공들

OIDC에서는 OAuth의 주인공들을 약간 다른 이름으로 부릅니다.

- **OpenID Provider (OP)**: `구글`, `페이스북`, `카카오`처럼 사용자의 신원 정보를 가지고 있으면서, 인증을 수행해주는 서비스입니다. (OAuth의 인가 서버 역할 포함)
- **Relying Party (RP)**: OP가 제공하는 인증 기능에 의존하여 사용자의 로그인을 처리하는 서비스입니다. 우리 예시에서는 `ChatGPT`가 RP에 해당합니다. (OAuth의 클라이언트)

---

### OIDC 워크플로우: OAuth에 'ID 토큰' 더하기

OIDC의 전체적인 흐름은 지난 글에서 배운 OAuth의 '인증 코드 승인' 방식과 거의 동일합니다. `ChatGPT`가 구글에 `Client ID`와 `Scope`를 미리 설정해두는 것부터 시작해서, 사용자가 동의하고 `Authorization Code`를 발급받아 `Access Token`으로 교환하는 과정까지 똑같죠.

OIDC의 마법은 바로 마지막 단계에서 일어납니다.

#### **OAuth와 동일한 1~8단계**

`ChatGPT` 백엔드가 `Authorization Code`와 `Client ID/Secret`을 구글(OP)에 보내 '만능 열쇠(`Access Token`)'를 요청합니다.

#### **9단계: 결정적 차이! 'ID 토큰'의 등장**

구글(OP)은 `Access Token`과 함께, 아주 특별한 **`ID 토큰(ID Token)`** 을 추가로 발급해줍니다.

> **ID 토큰이란?** 💳
>
> `ID 토큰`은 **사용자의 신원 정보가 담겨있는 '전자 신분증'** 입니다. 이 토큰은 반드시 **JWT 형식**으로 되어 있으며, 안에는 OP가 확인해 준 사용자의 고유 ID, 이메일 주소, 이름, 프로필 사진 URL 등의 정보가 담겨 있습니다.
>
> - **`Access Token`**: 리소스 서버(예: 구글 캘린더 API)에 **접근**하기 위한 '만능 열쇠'
> - **`ID Token`**: Relying Party(`ChatGPT`)가 사용자의 **신원**을 확인하기 위한 '신분증'

#### **10~14단계: 로그인 또는 회원가입 처리**

1. `ChatGPT` 백엔드는 전달받은 **`ID 토큰`** 을 열어보고, 그 안에 담긴 사용자 정보를 확인합니다.
2. 만약 이 사용자가 `ChatGPT`에 처음 방문했다면, `ID 토큰` 속 정보를 바탕으로 **새로운 회원가입을 자동으로 처리**합니다.
3. 이미 가입된 사용자라면, **로그인 처리를 완료**합니다.
4. 이후 `ChatGPT`는 자체적인 인증 방식(세션 쿠키 또는 자체 JWT 토큰)을 사용자 브라우저에 발급하여, `ChatGPT` 서비스 내에서의 로그인 상태를 유지시킵니다.

`ID 토큰`의 정보만으로 부족하다면, 함께 발급받은 `Access Token`을 사용해 구글의 `/userinfo`와 같은 API를 호출하여 추가적인 프로필 정보를 가져올 수도 있습니다.

---

### ✍️ 마무리하며

- **OIDC**는 **OAuth 2.0 위에 구축된 '인증' 계층**으로, 우리가 아는 **'소셜 로그인'** 기능의 핵심 기술입니다.
- OIDC는 기존 OAuth 흐름에, 사용자의 신원 정보가 담긴 **`ID 토큰`(JWT 형식)을 추가로 발급** 하는 것이 핵심입니다.
- `Access Token`이 **'권한'** 을 위한 것이라면, `ID Token`은 **'인증'** 을 위한 것입니다.
- 서비스(RP)는 이 `ID 토큰`을 통해 사용자의 신원을 확인하고, 편리하게 회원가입 및 로그인 처리를 수행할 수 있습니다.
