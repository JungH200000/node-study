## 🎯 Dynamic URL 처리하기

웹 서비스를 만들다 보면 URL이 고정되어 있지 않고, 특정 값에 따라 동적으로 바뀌어야 할 때가 많습니다. 예를 들어, 할 일(Task)의 상세 정보를 보는 페이지는 할 일의 고유 ID에 따라 `/tasks/1`, `/tasks/2` 와 같이 각각 다른 URL을 가져야 하죠.

수천, 수만 개의 할 일이 생길 때마다 모든 URL 경로를 미리 만들어 둘 수는 없습니다. 이럴 때 사용하는 것이 바로 **다이나믹 URL(Dynamic URL)** 또는 **동적 라우팅(Dynamic Routing)** 입니다.

Express에서는 이런 동적 URL을 매우 간단하게 처리할 수 있습니다. URL에서 동적으로 변하는 부분을 **URL 파라미터(URL Parameter)** 로 지정하는 방식입니다.

```javascript
app.get('/tasks/:id', (req, res) => {
  // :id 부분에 어떤 값이 들어와도 이 핸들러가 실행됩니다.
});
```

위 코드처럼 경로에 콜론(`:`)을 사용하고 뒤에 파라미터 이름을 지정하면 됩니다. 여기서 `:id`가 바로 URL 파라미터이며, 'id'라는 이름으로 해당 위치의 값을 받아올 수 있습니다.

### ❓ URL 파라미터는 어떻게 가져올까요?

Express는 URL 파라미터로 들어온 값을 자동으로 `request` 객체의 `params` 프로퍼티에 담아줍니다. 만약 우리가 `:id`라고 이름을 지었다면, `req.params.id`로 그 값을 꺼내 쓸 수 있습니다.

아래 전체 코드를 보며 실제로 어떻게 특정 ID를 가진 할 일을 찾고, 만약 존재하지 않을 경우 어떻게 처리하는지 살펴보겠습니다.

### 💻 전체 코드 예시

```js
// node01-start-javascript-backend/todo-api/app.js
import express from 'express';
import tasks from './data/mock.js';

const app = express();

// --- 모든 할 일 목록 가져오기 (정렬 및 개수 제한 기능 포함) ---
app.get('/tasks', (req, res) => {
  /**
   * 쿼리 파라미터를 받아 task 목록을 정렬하고 개수를 제한합니다.
   * sort - 'oldest'인 경우 오래된 순, 그 외에는 최신 순으로 정렬합니다. (기본값: 최신 순)
   * count - 응답으로 보낼 task의 최대 개수입니다.
   */
  const { sort, count: countStr } = req.query;
  const count = Number(countStr);

  const compareFn = sort === 'oldest' ? (a, b) => a.createdAt - b.createdAt : (a, b) => b.createdAt - a.createdAt;

  let newTasks = [...tasks].sort(compareFn);

  if (count) {
    newTasks = newTasks.slice(0, count);
  }

  res.send(newTasks);
});

// --- 특정 ID를 가진 할 일 정보 가져오기 (Dynamic URL 처리) ---
app.get('/tasks/:id', (req, res) => {
  // 1. req.params 객체에서 URL 파라미터(:id) 값을 가져옵니다.
  //    URL을 통해 전달된 값은 기본적으로 '문자열'이므로, 숫자와 비교하기 위해 Number()로 변환합니다.
  const id = Number(req.params.id);

  // 2. tasks 배열에서 요청된 id와 일치하는 할 일을 찾습니다.
  const task = tasks.find((task) => task.id === id);

  // 3. 할 일을 찾았는지 확인합니다.
  if (task) {
    // 3-1. 할 일을 찾았다면, 해당 할 일 정보를 응답으로 보냅니다.
    res.send(task);
  } else {
    // 3-2. 할 일을 찾지 못했다면, 클라이언트에게 리소스를 찾을 수 없다는 것을 명확히 알려줍니다.
    //      HTTP 상태 코드 404 Not Found를 설정하는 것이 일반적인 REST API 규칙입니다.
    res.status(404).send({ message: 'Cannot find given id.' });
  }
});

app.listen(3000, () => {
  console.log('Server started on port 3000');
  console.log(`http://localhost:3000`);
});
```

### ✅ 실행 결과 확인하기

VS Code의 REST Client와 같은 도구를 사용해 API를 테스트해보겠습니다.

#### 1\. ID가 1인 할 일 조회 (성공 케이스)

`requests.http` 파일에 아래와 같이 작성하고 `Send Request`를 실행합니다.

```http
GET http://localhost:3000/tasks/1
```

**[응답 결과]**
서버는 ID가 1인 할 일 데이터를 성공적으로 찾아 `200 OK` 상태 코드와 함께 JSON 형식으로 응답합니다.

```json
HTTP/1.1 200 OK
Content-Type: application/json; charset=utf-8
// ... 기타 헤더

{
  "id": 1,
  "title": "30분 운동",
  "isComplete": false,
  "createdAt": "2023-03-23T06:34:07.617Z",
  "updatedAt": "2023-03-23T06:34:07.617Z"
}
```

#### 2\. 존재하지 않는 ID 조회 (실패 케이스)

이번에는 데이터에 없는 ID(예: 10)를 요청해 보겠습니다.

```http
GET http://localhost:3000/tasks/10
```

**[응답 결과]**
코드에서 `find` 메소드로 할 일을 찾지 못했기 때문에 `else` 블록이 실행됩니다. `404 Not Found` 상태 코드와 함께 우리가 지정한 에러 메시지가 담긴 JSON 객체가 응답으로 돌아옵니다.

```json
HTTP/1.1 404 Not Found
Content-Type: application/json; charset=utf-8
// ... 기타 헤더

{
  "message": "Cannot find given id."
}
```

이처럼 다이나믹 URL을 활용하면, 변화하는 값에 따라 각각 다른 데이터를 보여주는 API를 효율적으로 구현할 수 있습니다. 😊
