## ✅ 새로운 데이터 생성하기: POST 요청 처리 가이드

지금까지는 서버에 있는 데이터를 조회하는 `GET` 요청만 다루었습니다. 이번에는 클라이언트가 새로운 데이터를 생성해서 서버에 보내는 **`POST` 요청**을 처리하는 방법을 알아보겠습니다. 할 일(Task) 목록에 새로운 할 일을 추가하는 기능을 함께 만들어봐요\!

`POST` 요청은 웹에서 '글쓰기', '회원가입', '상품 등록' 등 새로운 리소스를 생성할 때 사용되는 HTTP 메소드입니다.

### 1. 클라이언트에서 보낼 요청(Request) 준비하기

먼저, 새로운 할 일을 생성하기 위해 클라이언트가 서버로 보낼 요청이 어떻게 생겼는지 살펴보겠습니다. VS Code의 REST Client를 사용한다면 `requests.http` 파일에 다음과 같이 작성할 수 있습니다.

```http
POST http://localhost:3000/tasks
Content-Type: application/json

{
  "title": "게임하기",
  "description": "명조:워더링웨이브 일일 퀘스트 수행"
}
```

- **`POST http://localhost:3000/tasks`**: 어떤 서버 주소(`http://localhost:3000/tasks`)로, 어떤 메소드(`POST`)를 사용해 요청을 보낼지 지정합니다.
- **`Content-Type: application/json`**: 요청의 본문(Body)에 담긴 데이터 형식이 JSON이라는 것을 서버에 알려주는 **헤더(Header)** 정보입니다.
- **`{ ... }`**: 요청의 **본문(Body)** 입니다. 새로 생성할 할 일의 `title`과 `description` 정보를 JSON 형식으로 담아 보냅니다. `id`나 `createdAt`처럼 서버에서 생성해야 할 정보는 포함하지 않습니다.

### 2. Express로 POST 라우트 만들기

이제 서버에서 위 요청을 받아서 처리할 수 있는 코드를 `app.js`에 추가해 보겠습니다.

#### ✨ 핵심 포인트: `express.json()` 미들웨어

클라이언트가 JSON 형식으로 데이터를 보냈을 때, Express는 이 데이터를 바로 JavaScript 객체로 해석하지 못합니다. **요청 본문(Request Body)에 담긴 JSON 문자열을 JavaScript 객체로 변환(Parsing)** 해주는 과정이 필요합니다.

이 역할을 해주는 것이 바로 `express.json()`이라는 **미들웨어(Middleware)** 입니다.

```javascript
app.use(express.json());
```

위 코드를 `app.js` 상단에 추가하면, 앞으로 들어오는 모든 요청에 대해 `Content-Type`이 `application/json`일 경우, Express가 자동으로 본문을 파싱하여 `req.body`에 자바스크립트 객체로 담아줍니다.

#### 💻 전체 코드

`express.json()` 미들웨어와 새로운 `app.post('/tasks', ...)` 라우트 핸들러를 추가한 전체 코드는 다음과 같습니다.

```js
// node01-start-javascript-backend/todo-api/app.js
import express from 'express';
import tasks from './data/mock.js';

const app = express();

// JSON 요청 본문을 파싱하기 위한 미들웨어 설정
app.use(express.json());

// --- 모든 할 일 목록 가져오기 ---
app.get('/tasks', (req, res) => {
  const { sort, count: countStr } = req.query;
  const count = Number(countStr);
  const compareFn = sort === 'oldest' ? (a, b) => a.createdAt - b.createdAt : (a, b) => b.createdAt - a.createdAt;
  let newTasks = [...tasks].sort(compareFn);
  if (count) {
    newTasks = newTasks.slice(0, count);
  }
  res.send(newTasks);
});

// --- 특정 ID를 가진 할 일 정보 가져오기 ---
app.get('/tasks/:id', (req, res) => {
  const id = Number(req.params.id);
  const task = tasks.find((task) => task.id === id);
  if (task) {
    res.send(task);
  } else {
    res.status(404).send({ message: 'Cannot find given id.' });
  }
});

// --- 새로운 할 일 추가하기 ---
app.post('/tasks', (req, res) => {
  // 1. express.json() 미들웨어 덕분에 req.body에서 바로 JS 객체를 사용할 수 있습니다.
  const newTask = req.body;

  // 2. 새로운 task에 필요한 추가 정보를 서버에서 생성합니다.
  //    (실제 서비스에서는 데이터베이스가 자동으로 처리해 줄 부분입니다.)
  const ids = tasks.map((task) => task.id);
  const newId = Math.max(...ids) + 1; // 현재 ID 중 가장 큰 값에 1을 더해 새 ID를 만듭니다.

  newTask.id = newId;
  newTask.isComplete = false;
  newTask.createdAt = new Date();
  newTask.updatedAt = new Date();

  // 3. 새로운 task를 기존 tasks 배열에 추가합니다.
  tasks.push(newTask);

  // 4. REST API 규칙에 따라, 리소스가 성공적으로 생성되었음을 알리는
  //    201 Created 상태 코드와 함께 생성된 데이터를 응답으로 보냅니다.
  res.status(201).send(newTask);
});

app.listen(3000, () => {
  console.log('Server started on port 3000');
  console.log(`http://localhost:3000`);
});
```

### 3. 실행 결과 확인하기

이제 서버를 실행하고, 준비했던 `POST` 요청을 보내봅시다.

#### 요청 (Request)

```http
POST http://localhost:3000/tasks
Content-Type: application/json

{
  "title": "게임하기",
  "description": "명조:워더링웨이브 일일 퀘스트 수행"
}
```

#### 응답 (Response)

서버는 `201 Created` 상태 코드와 함께, 서버에서 생성한 `id`, `isComplete` 등의 정보가 포함된 완전한 할 일(Task) 객체를 반환합니다.

```json
HTTP/1.1 201 Created
Content-Type: application/json; charset=utf-8
// ... 기타 헤더

{
  "title": "게임하기",
  "description": "명조:워더링웨이브 일일 퀘스트 수행",
  "id": 6,
  "isComplete": false,
  "createdAt": "2025-08-21T04:13:09.194Z",
  "updatedAt": "2025-08-21T04:13:09.194Z"
}
```

#### 전체 목록 조회로 확인

`GET http://localhost:3000/tasks` 요청을 다시 보내보면, 방금 추가한 '게임하기' 할 일이 목록 맨 위에 성공적으로 추가된 것을 확인할 수 있습니다.

```json
HTTP/1.1 200 OK
// ...

[
  {
    "title": "게임하기",
    "description": "명조:워더링웨이브 일일 퀘스트 수행",
    "id": 6,
    "isComplete": false,
    "createdAt": "2025-08-21T04:13:09.194Z",
    "updatedAt": "2025-08-21T04:13:09.194Z"
  },
  {
    "id": 5,
    "title": "파이썬 공부",
    // ...
  }
  // ... 나머지 할 일들
]
```

이제 여러분의 API 서버는 데이터를 조회하는 것뿐만 아니라, 새로운 데이터를 생성하는 중요한 기능까지 갖추게 되었습니다\! 🎉
