## 🌱 데이터베이스에 씨앗 심기: 시드 데이터(Seed Data) 넣기

서버 개발을 시작할 때 데이터베이스가 텅 비어있다면, API가 제대로 작동하는지 확인하기 어렵습니다. 이때 **시드 데이터(Seed Data)** 를 사용합니다.

**시딩(Seeding)** 이란 '씨를 뿌리다'라는 뜻처럼, 개발 초기 단계에서 데이터베이스에 기본 데이터를 미리 넣어두는 과정을 말합니다. 이 초기 데이터를 **시드 데이터**라고 부릅니다.

이제 우리가 가지고 있는 `mock.js` 파일의 데이터를 MongoDB에 심어(seeding) 보겠습니다.

### 1단계: 시드 스크립트 파일 생성하기

데이터 시딩 작업만을 위한 별도의 스크립트 파일을 만듭니다. 프로젝트에 `data` 폴더가 있다면, 그 안에 `seed.js` 파일을 생성합니다.

### 2단계: 시드 스크립트 작성하기

`seed.js` 파일은 독립적으로 실행되어야 하므로, 데이터베이스 연결부터 데이터 삽입, 연결 종료까지의 모든 과정을 포함해야 합니다.

#### 💻 최종 코드 (수정된 부분 포함)

```javascript
// /data/seed.js

import mongoose from 'mongoose';
import dotenv from 'dotenv';
import data from './mock.js';
import Task from '../models/Taks.js';

// .env 파일의 환경 변수를 로드합니다.
dotenv.config();

// --- 스크립트 핵심 로직 ---

// 1. 데이터베이스에 연결합니다.
await mongoose.connect(process.env.DATABASE_URL);
console.log('🌱 DB Connection Successful');

// 2. 기존 데이터를 모두 삭제합니다. (초기화)
await Task.deleteMany({});
console.log('🗑️ All data deleted');

// 3. mock.js 파일의 데이터를 DB에 삽입합니다.
await Task.insertMany(data);
console.log('📥 Data seeded successfully');

// 4. 데이터베이스 연결을 종료합니다.
await mongoose.connection.close();
console.log('🚪 DB Connection Closed');
```

#### ⚙️ 코드 로직 해설

- **`await Task.deleteMany({})`**: `Task` 모델과 연결된 컬렉션의 모든 데이터를 삭제합니다. `{}` 빈 객체를 조건으로 전달하면 '모든 데이터'를 의미합니다.
- **`await Task.insertMany(data)`**: `mock.json`에서 불러온 `data` 배열을 컬렉션에 한 번에 삽입합니다.
- **`await` 키워드**: 데이터베이스 작업은 모두 비동기(asynchronous)로 처리되므로, 각 작업이 끝날 때까지 기다리도록 `await`를 반드시 붙여주어야 합니다.
- **`mongoose.connection.close()`**: 시드 스크립트는 한 번만 실행되고 끝나는 프로그램이므로, 모든 작업이 끝나면 데이터베이스 연결을 명시적으로 종료해주는 것이 좋습니다.

### 3단계: `package.json`에 스크립트 추가하기

매번 `node data/seed.js`라고 길게 입력하는 대신, 더 간단한 명령어로 스크립트를 실행할 수 있도록 `package.json`에 `seed` 명령어를 추가합니다.

```json
// package.json
{
  // ...
  "scripts": {
    "dev": "nodemon app.js",
    "start": "node app.js",
    "seed": "node data/seed.js"
  }
  // ...
}
```

### 4단계: 스크립트 실행 및 결과 확인

이제 터미널에 아래 명령어를 입력하여 시드 스크립트를 실행합니다.

```bash
npm run seed
```

**[터미널 실행 결과]**

```
> todo-api@1.0.0 seed
> node data/seed.js

DB Connection Successful
All data deleted
Data seeded successfully
DB Connection Closed
```

이제 **MongoDB Atlas** 대시보드로 가서 `todo-api` 데이터베이스의 `tasks` 컬렉션을 확인해 보세요. `mock.js`의 데이터가 성공적으로 들어가 있는 것을 볼 수 있습니다.

> **💡 `_id`와 `__v` 필드**
> 데이터를 확인해 보면 `_id`와 `__v`라는 필드가 추가된 것을 볼 수 있습니다.
>
> - **`_id`**: MongoDB가 각 데이터를 구별하기 위해 자동으로 생성하는 고유 ID입니다.
> - **`__v` (versionKey)**: Mongoose가 데이터 버전을 관리하기 위해 내부적으로 사용하는 값이므로 신경 쓰지 않아도 됩니다.
