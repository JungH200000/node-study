## 🕵️‍♂️ 원하는 데이터만 찾기\! Mongoose 쿼리 필터(query filter) 사용법

데이터베이스에서 모든 데이터를 가져오는 대신, 특정 조건을 만족하는 데이터만 골라서 조회하고 싶을 때가 있습니다. Mongoose의 `find()` 메소드에 **필터 객체(filter object)** 를 전달하면, 마치 탐정이 단서를 찾아내듯 원하는 데이터만 정확하게 찾아낼 수 있습니다.

`persons`라는 컬렉션에 아래와 같은 데이터가 있고, 이를 다루는 `Person` 모델이 있다고 가정하고 다양한 필터링 방법을 알아봅시다.

**[예시 데이터]**

```json
[
  { "name": "James", "email": "james@gmail.com", "age": 26 },
  { "name": "Charlie", "email": "charlie@naver.com", "age": 30 },
  { "name": "Alice", "email": "alice@gmail.com", "age": 21 },
  { "name": "Paul", "email": "paul@naver.com", "age": 40 },
  { "name": "Hannah", "email": "hannah@gmail.com", "age": 34 }
]
```

---

### 1. 정확히 일치하는 값 찾기

가장 기본적이고 많이 사용하는 방법입니다. 필드의 값이 특정 값과 정확히 일치하는 데이터를 찾습니다.

**`name`이 'James'인 사람 찾기**

```javascript
Person.find({ name: 'James' });
```

**[결과]**

```json
[{ "name": "James", "email": "james@gmail.com", "age": 26 }]
```

---

### 2. 값을 비교해서 찾기 (비교 연산자)

숫자나 날짜 필드의 값을 비교하여 데이터를 찾을 수 있습니다. MongoDB는 `$`로 시작하는 다양한 비교 연산자를 제공합니다.

| 연산자     | 의미                                     | 예시                    |
| :--------- | :--------------------------------------- | :---------------------- |
| **`$gt`**  | **g**reater **t**han (초과)              | `{ age: { $gt: 35 } }`  |
| **`$gte`** | **g**reater **t**han or **e**qual (이상) | `{ age: { $gte: 40 } }` |
| **`$lt`**  | **l**ess **t**han (미만)                 | `{ age: { $lt: 30 } }`  |
| **`$lte`** | **l**ess **t**han or **e**qual (이하)    | `{ age: { $lte: 21 } }` |

**`age`가 35를 초과하는(`$gt`) 사람 찾기**

```javascript
Person.find({ age: { $gt: 35 } });
```

**[결과]**

```json
[{ "name": "Paul", "email": "paul@naver.com", "age": 40 }]
```

---

### 3. 특정 패턴(문자열)으로 찾기 (`$regex`)

문자열 필드가 특정 패턴을 포함하고 있는지 **정규표현식(Regular Expression)** 으로 검사합니다.

**`email`이 'gmail.com'으로 끝나는(`$`) 사람 찾기**

```javascript
Person.find({ email: { $regex: 'gmail.com$' } });
```

**[결과]**

```json
[
  { "name": "James", "email": "james@gmail.com", "age": 26 },
  { "name": "Alice", "email": "alice@gmail.com", "age": 21 },
  { "name": "Hannah", "email": "hannah@gmail.com", "age": 34 }
]
```

---

### 4. 여러 조건으로 찾기 (AND, OR)

#### AND 조건 (모두 만족)

**여러 조건을 모두 만족**하는 데이터를 찾으려면, 필터 객체 안에 여러 조건을 쉼표로 구분하여 나열하면 됩니다. 이는 기본적으로 AND 연산으로 동작합니다.

**`age`가 32 미만이면서(`$lt`) `email`이 'gmail.com'으로 끝나는 사람 찾기**

```javascript
Person.find({ age: { $lt: 32 }, email: { $regex: 'gmail.com$' } });
```

**[결과]**

```json
[
  { "name": "James", "email": "james@gmail.com", "age": 26 },
  { "name": "Alice", "email": "alice@gmail.com", "age": 21 }
]
```

#### OR 조건 (하나라도 만족)

**여러 조건 중 하나라도 만족**하는 데이터를 찾으려면 **`$or`** 연산자를 사용하고, 조건들을 배열 안에 담아 전달합니다.

**`age`가 32 미만이거나(`$lt`) `email`이 'gmail.com'으로 끝나는 사람 찾기**

```javascript
Person.find({ $or: [{ age: { $lt: 32 } }, { email: { $regex: 'gmail.com$' } }] });
```

**[결과]**

```json
[
  { "name": "James", "email": "james@gmail.com", "age": 26 },
  { "name": "Charlie", "email": "charlie@naver.com", "age": 30 },
  { "name": "Alice", "email": "alice@gmail.com", "age": 21 },
  { "name": "Hannah", "email": "hannah@gmail.com", "age": 34 }
]
```

---

### 💡 팁: 딱 하나만 찾고 싶을 땐 `.findOne()`

`find()`는 조건을 만족하는 모든 데이터를 배열로 반환하지만, 조건을 만족하는 **첫 번째 데이터 하나만** 객체 형태로 받고 싶을 때는 **`findOne()`** 메소드를 사용하면 편리합니다.

`findOne()`은 위에서 배운 모든 필터 규칙을 동일하게 사용할 수 있습니다.

```javascript
// name이 'James'인 사람 '하나만' 찾기
Person.findOne({ name: 'James' });
```

**[결과]** (배열이 아닌 객체)

```json
{ "name": "James", "email": "james@gmail.com", "age": 26 }
```

> **`.findById()` vs `.findOne()`** > `_id`로 데이터를 찾을 때는 `findById()`를 사용하는 것이 가장 빠르고 명확합니다. `_id`가 아닌 다른 조건으로 데이터 하나를 찾아야 할 때 `findOne()`을 사용하세요.
