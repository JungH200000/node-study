## 🚪 다른 서버와의 통신 규칙, CORS 설정하기

백엔드 서버 배포를 마쳤다고 해서 프론트엔드와 바로 통신할 수 있는 것은 아닙니다. 지금 상태에서 프론트엔드 JavaScript 코드가 우리 API에 데이터를 요청하면, 브라우저는 보안상의 이유로 이 요청을 차단하며 **CORS 오류**를 발생시킵니다.

> **[대표적인 CORS 오류 메시지]** > `Access to fetch at <API 주소> from origin <프론트엔드 주소> has been blocked by CORS policy: No 'Access-Control-Allow-Origin' header is present on the requested resource.`

이 문제를 해결하려면 우리 백엔드 서버에서 **CORS(Cross-Origin Resource Sharing)** 를 허용하도록 설정해야 합니다.

### CORS, 대체 왜 필요한 걸까요?

웹 브라우저가 웹사이트를 로딩하는 과정을 간단히 살펴보면 그 이유를 알 수 있습니다.

1.  사용자는 `https://my-awesome-app.com` (프론트엔드 서버)에 접속해 HTML, CSS, JavaScript 파일을 내려받습니다.
2.  브라우저에서 실행된 JavaScript 코드가 `https://api.my-awesome-app.com` (백엔드 서버)으로 데이터를 요청합니다.
3.  백엔드로부터 받은 데이터를 화면에 예쁘게 그려줍니다.

이 과정에서 브라우저는 아주 중요한 보안 정책을 따릅니다. 바로 **SOP(Same-Origin Policy, 동일 출처 정책)** 입니다.

#### 동일 출처 정책 (SOP)

SOP는 웹 브라우저의 핵심적인 보안 규칙으로, **"하나의 출처(Origin)에서 로드된 문서나 스크립트는 다른 출처의 리소스와 상호작용할 수 없다"** "는 원칙입니다. 여기서 **출처(Origin)** 란 URL의 **프로토콜 + 호스트(도메인) + 포트 번호**의 조합을 의미합니다.

| URL                     | 프로토콜 | 호스트        | 포트 | 출처                    |
| :---------------------- | :------- | :------------ | :--- | :---------------------- |
| `http://example.com:80` | `http`   | `example.com` | `80` | `http://example.com:80` |

위 예시에서 프론트엔드(`https://my-awesome-app.com`)와 백엔드(`https://api.my-awesome-app.com`)는 호스트(도메인)가 다르므로, SOP에 따라 서로 다른 출처로 간주됩니다. 따라서 브라우저는 기본적으로 프론트엔드의 JavaScript 요청을 차단하는 것입니다.

#### SOP는 왜 존재할까요? (보안)

SOP는 악의적인 웹사이트로부터 사용자를 보호하기 위해 존재합니다. 만약 SOP가 없다면, 우리가 `https://hacker-site.com`에 방문했을 때, 그 사이트에 숨겨진 스크립트가 우리가 로그인해 둔 `https://my-bank.com`으로 몰래 요청을 보내 개인 정보를 탈취할 수도 있습니다. SOP는 이런 위험한 시도를 원천적으로 차단하는 역할을 합니다.

#### CORS: 안전한 교차 출처 통신 규칙

그렇다면 다른 출처와는 절대 통신할 수 없을까요? 아닙니다. **CORS(Cross-Origin Resource Sharing, 교차 출처 리소스 공유)** 는 바로 이 SOP 제약을 넘어, **신뢰할 수 있는 다른 출처가 우리 서버의 리소스에 접근하는 것을 허용해주는 공식적인 규칙 체계**입니다.

즉, 우리 백엔드 서버가 응답 헤더에 **"나는 `https://my-awesome-app.com`からの 요청을 허용해\!"** 라는 `Access-Control-Allow-Origin` 표식을 달아주면, 브라우저는 안심하고 데이터를 전달해 줍니다.

---

### Express에서 CORS 허용하기

Express에서는 `cors`라는 라이브러리를 사용해 아주 간단하게 CORS 설정을 할 수 있습니다.

#### 1\. `cors` 라이브러리 설치

터미널에 아래 명령어를 입력해 설치합니다.

```bash
npm install cors
```

#### 2\. `app.js`에 CORS 미들웨어 추가하기

`cors`를 `import`하고 `app.use(cors())` 코드를 추가하면 됩니다. 이 코드는 다른 라우트들보다 위에 위치하는 것이 좋습니다.

##### 방법 1: 모든 출처 허용하기

가장 간단한 방법으로, 어떤 출처에서 오는 요청이든 모두 허용합니다. 개발 초기 단계에서 편리하게 사용할 수 있습니다.

```javascript
// /app.js
import express from 'express';
import cors from 'cors';
// ...

const app = express();

app.use(cors()); // 모든 출처에 대해 CORS 허용
app.use(express.json());

// ... 라우트 코드
```

##### 방법 2: 특정 출처만 허용하기 (보안상 권장)

실제 서비스를 운영할 때는 우리 프론트엔드 서버 주소처럼 신뢰할 수 있는 출처만 허용하는 것이 안전합니다.

```javascript
// /app.js
import express from 'express';
import cors from 'cors';
// ...

const app = express();

const corsOptions = {
  origin: ['http://localhost:3000', 'https://my-awesome-app.com'],
};

app.use(cors(corsOptions)); // 특정 출처에 대해서만 CORS 허용
app.use(express.json());

// ... 라우트 코드
```

`origin` 옵션에 허용할 출처들의 주소를 배열 형태로 넣어주면, 해당 주소에서 오는 요청만 안전하게 처리할 수 있습니다.
