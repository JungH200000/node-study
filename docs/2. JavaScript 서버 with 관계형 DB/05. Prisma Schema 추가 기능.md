## ✨ Prisma 스키마 업그레이드: `enum`과 `@@unique` 활용하기

Prisma 스키마는 단순히 필드의 타입만 정의하는 것을 넘어, 데이터의 일관성과 무결성을 지키기 위한 강력하고 편리한 추가 기능들을 제공합니다. 그중 가장 유용하게 쓰이는 `enum`과 `@@unique`에 대해 알아봅시다.

---

### 1. 🏷️ 정해진 값만 허용하기: `enum`

만약 유저의 멤버십 등급을 `BASIC`과 `PREMIUM` 두 가지로만 제한하고 싶다면 어떻게 해야 할까요? 이렇게 **필드에 들어갈 수 있는 값이 몇 가지 정해진 목록 중 하나일 때**는 **`enum`** 을 사용할 수 있습니다.

`enum`은 서로 관련된 **상수(constant)들의 집합**을 정의하는 기능입니다. 마치 객관식 문제의 '보기' 목록을 만들어주는 것과 같죠.

**`schema.prisma` 파일에 아래와 같이 `enum`을 정의하고 `User` 모델에 적용합니다.**

```prisma
model User {
  // ... 기존 필드 생략

  // membership 필드의 타입으로 Membership enum을 지정하고,
  // 기본값으로 BASIC을 설정합니다.
  membership Membership @default(BASIC)
}

// Membership이라는 이름의 enum을 정의합니다.
enum Membership {
  BASIC
  PREMIUM
  // VIP 등급을 추가하고 싶다면 여기에 추가하면 됩니다.
}
```

- **`enum Membership { ... }`**: `Membership`이라는 이름으로 `enum`을 정의합니다. `enum`의 각 값은 보통 **대문자**로 작성하는 것이 관례입니다.
- **`membership Membership`**: `User` 모델의 `membership` 필드가 `Membership` `enum` 타입의 값만 가질 수 있도록 지정합니다.
- **`@default(BASIC)`**: `@default` 속성을 사용해 새로운 유저가 생성될 때 기본 멤버십을 `BASIC`으로 설정할 수 있습니다.

> **⚠️ 참고:** `enum`은 모든 데이터베이스에서 지원하는 기능은 아닙니다. 예를 들어 **SQLite**에서는 Prisma `enum`을 사용할 수 없습니다. (PostgreSQL, MySQL 등에서는 사용 가능)

---

### 2. 👯 여러 필드의 조합을 고유하게 만들기: `@@unique`

이메일처럼 필드 하나만으로 고유한 값을 보장할 때는 `@unique`를 사용했습니다. 하지만 **두 개 이상의 필드를 조합했을 때 그 조합이 고유해야 하는 경우**도 있습니다. 예를 들어, '이름(firstName)'과 '성(lastName)'이 완전히 똑같은 유저는 단 한 명만 존재하도록 규칙을 만들고 싶을 때입니다.

이럴 때는 **`@@unique`** 속성을 사용합니다. `@@`로 시작하는 속성은 특정 필드가 아닌 모델 전체에 적용되므로, 모델 블록의 가장 아래쪽에 작성합니다.

```prisma
model User {
  id        String   @id @default(uuid())
  email     String   @unique
  firstName String
  lastName  String
  address   String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // firstName과 lastName의 조합이 고유해야 함을 명시합니다.
  @@unique([firstName, lastName])
}
```

이렇게 설정하면 `firstName`이나 `lastName` 각각은 중복될 수 있지만, 두 필드의 **조합**은 절대 중복될 수 없습니다.

#### ✅ 삽입 가능한 경우 (조합이 다름)

```json
{ "firstName": "길동", "lastName": "홍" }
{ "firstName": "길동", "lastName": "박" } // lastName이 다르므로 OK
```

#### ❌ 삽입 불가능한 경우 (조합이 같음)

```json
{ "firstName": "길동", "lastName": "홍" }
{ "firstName": "길동", "lastName": "홍" } // 조합이 완전히 같으므로 Error!
```

이처럼 `enum`과 `@@unique` 같은 기능들을 활용하면, 데이터베이스 차원에서 데이터의 규칙을 강제하여 더 견고하고 신뢰성 있는 애플리케이션을 만들 수 있습니다.
