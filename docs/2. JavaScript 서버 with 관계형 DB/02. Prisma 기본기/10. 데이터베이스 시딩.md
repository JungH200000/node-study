## 🌱 데이터베이스에 씨앗 심기: Prisma 시딩 (Seeding)

애플리케이션을 개발하고 테스트하려면 데이터베이스에 어느 정도 데이터가 채워져 있어야 편리합니다. 이렇게 개발 초기에 데이터베이스에 **초기 데이터를 넣는 과정**을 **시딩(Seeding)** 이라고 부릅니다.

데이터 양이 많을 때는 Prisma Studio로 하나씩 추가하기보다, 미리 준비된 데이터를 스크립트로 한 번에 삽입하는 것이 훨씬 효율적입니다.

### 1단계: 시드(Seed) 스크립트 준비하기

#### 1\. mock 데이터 파일 준비

먼저, 데이터베이스에 넣을 초기 데이터를 담은 `mock.js` 파일을 준비합니다. 이 파일을 Prisma 관련 파일들과 함께 두기 위해 `prisma` 폴더 안에 `mock.js`라는 이름으로 저장하겠습니다.

```javascript
// /prisma/mock.js
export const USERS = [
  {
    id: 'b8f11e76-0a9e-4b3f-bccf-8d9b4fbf331e',
    email: 'honggd@example.com',
    firstName: '길동',
    lastName: '홍',
    address: '서울특별시 강남구 무실로 123번길 45-6',
    // createdAt, updatedAt은 Prisma가 자동으로 관리하므로 mock 데이터에서는 빼도 좋습니다.
  },
  // ... (다른 유저 데이터)
];
```

#### 2\. 시드 스크립트 파일 생성

Prisma의 공식 가이드에 따라, `prisma` 폴더 안에 `seed.js` 파일을 생성하고 아래의 기본 코드를 작성합니다.

```javascript
// /prisma/seed.js
import { PrismaClient } from '../generated/prisma/index.js';

const prisma = new PrismaClient();

async function main() {
  // 여기에 시딩 로직을 작성합니다.
}

// main 함수를 실행하고, 성공/실패 시 DB 연결을 끊도록 보장합니다.
main()
  .then(async () => {
    await prisma.$disconnect();
  })
  .catch(async (e) => {
    console.error(e);
    await prisma.$disconnect();
    process.exit(1);
  });
```

이 코드는 Prisma 공식 문서에서 권장하는 안전한 실행 방식으로, `main()` 함수를 실행한 뒤 성공하든 실패하든 반드시 데이터베이스 연결(`prisma.$disconnect()`)을 종료시켜 줍니다.

---

### 2단계: 시딩 로직 구현하기

이제 `main()` 함수 안에 데이터베이스를 초기화하고 mock 데이터를 삽입하는 로직을 구현합니다.

```javascript
// /prisma/seed.js
import { PrismaClient } from '../generated/prisma/index.js';
import { USERS } from './mock.js'; // 같은 폴더의 mock.js에서 USERS를 가져옴

const prisma = new PrismaClient();

async function main() {
  // 1. 기존 User 데이터를 모두 삭제합니다.
  await prisma.user.deleteMany();
  console.log('🗑️ All users deleted.');

  // 2. mock 데이터를 DB에 삽입합니다.
  await prisma.user.createMany({
    data: USERS,
    skipDuplicates: true, // id나 email처럼 @unique 필드가 중복될 경우 무시
  });
  console.log('📥 Users seeded successfully.');
}

// ... (main 함수 실행 코드)
```

- **`await prisma.user.deleteMany()`**: `user` 테이블의 모든 데이터를 삭제하여 데이터베이스를 깨끗하게 비웁니다.
- **`await prisma.user.createMany()`**: 배열 형태의 데이터를 한 번에 여러 개 삽입합니다.
  - `data: USERS`: `mock.js`에서 가져온 `USERS` 배열을 전달합니다.
  - `skipDuplicates: true`: `id`나 `email`처럼 `@unique` 속성이 있는 필드의 값이 중복되는 데이터가 있다면, 에러를 발생시키는 대신 조용히 건너뜁니다.

> **⚠️ 참고:** `createMany()` 메소드는 **SQLite** 데이터베이스에서는 지원되지 않습니다.

---

### 3단계: `package.json`에 시드 스크립트 등록하기

이제 `npx prisma db seed`라는 편리한 명령어로 이 스크립트를 실행할 수 있도록 `package.json` 파일을 설정합니다.

`package.json` 파일을 열고, 최상위 레벨의 scripts 아래에 `"prisma"` 키를 추가해 주세요.

```json
// package.json
{
  "name": "e-commerce",
  // ...
  "scripts": {
    "dev": "nodemon app.js",
    "start": "node app.js"
  },
  "prisma": {
    "seed": "node prisma/seed.js"
  }
  // ...
}
```

---

### 4단계: 시딩 실행 및 결과 확인

이제 모든 준비가 끝났습니다. 터미널에 아래 명령어를 입력하여 시딩을 실행합니다.

```bash
npx prisma db seed
```

**[터미널 실행 결과]**

```
Environment variables loaded from .env
Running seed command `node prisma/seed.js` ...
🗑️ All users deleted.
📥 Users seeded successfully.

The seed command has been executed.
```

시딩이 성공적으로 완료되었습니다\! `npx prisma studio`를 실행하여 `User` 모델을 확인해 보면, `mock.js` 파일에 있던 5개의 유저 데이터가 예쁘게 들어가 있는 것을 볼 수 있습니다.

앞으로 데이터베이스를 초기 상태로 되돌리고 싶을 때마다 `npx prisma db seed` 명령어를 실행하면 됩니다.
