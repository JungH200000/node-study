## π”— μ΄λ―Έ μ΅΄μ¬ν•λ” λ°μ΄ν„° μ—°κ²°ν•κΈ°: `connect`μ™€ `disconnect`

μ΄μ „ κ°€μ΄λ“μ—μ„λ” `User`λ¥Ό μƒμ„±ν•λ©΄μ„ `UserPreference`λ¥Ό **ν•¨κ» μƒμ„±**ν•λ” λ°©λ²•μ„ λ°°μ› μµλ‹λ‹¤. ν•μ§€λ§ `User`κ°€ `Product`λ¥Ό 'μ°'ν•λ” κ²½μ°μ²λΌ, **μ΄λ―Έ μ΅΄μ¬ν•λ” λ°μ΄ν„°λ“¤ μ‚¬μ΄μ— μƒλ΅μ΄ κ΄€κ³„λ¥Ό λ§Ίμ–΄μ£Όμ–΄μ•Ό** ν•  λ•κ°€ λ” λ§μµλ‹λ‹¤.

Prismaλ” **`connect`** μ™€ **`disconnect`** λΌλ” μ§κ΄€μ μΈ μµμ…μ„ ν†µν•΄, μ΄λ° λ‹¤λ€λ‹¤(N:N) κ΄€κ³„λ¥Ό μ•„μ£Ό μ‰½κ² κ΄€λ¦¬ν•  μ μκ² ν•΄μ¤λ‹λ‹¤.

---

### 1. κ΄€κ³„ μ—°κ²°ν•κΈ° (`connect`)

'κΉ€μν¬'λΌλ” μ μ €κ°€ 'μΏ μ§„μ•¤μ—μ΄ μ¤λ―λ › ν¬' μƒν’μ„ μ° λ©λ΅μ— μ¶”κ°€ν•λ” APIλ¥Ό λ§λ“ λ‹¤κ³  κ°€μ •ν•΄ λ΄…μ‹λ‹¤.

#### 1λ‹¨κ³„: API μ—”λ“ν¬μΈνΈ λ° μ”μ²­ μ •μ

'μ–΄λ–¤ μ μ €'(`userId`)κ°€ 'μ–΄λ–¤ μƒν’'(`productId`)μ„ μ°ν•λ”μ§€ λ…ν™•ν λ‚νƒ€λ‚΄λ” APIλ¥Ό μ„¤κ³„ν•©λ‹λ‹¤. `POST` λ©”μ†λ“λ¥Ό μ‚¬μ©ν•΄ 'μ°'μ΄λΌλ” μƒλ΅μ΄ κ΄€κ³„λ¥Ό μƒμ„±ν•©λ‹λ‹¤.

**μ—”λ“ν¬μΈνΈ**: `POST /users/:id/saved-products`
**μ”μ²­ Body**:

```json
{
  "productId": "c28a2eaf-4d87-4f9f-ae5b-cbcf73e24253"
}
```

#### 2λ‹¨κ³„: μ ν¨μ„± κ²€μ‚¬ Struct λ§λ“¤κΈ°

μ”μ²­ Bodyλ΅ λ“¤μ–΄μ¤λ” `productId`κ°€ μ ν¨ν• UUID ν•μ‹μΈμ§€ κ²€μ‚¬ν•λ” `struct`λ¥Ό `structs.js`μ— μ¶”κ°€ν•©λ‹λ‹¤.

```javascript
// /structs.js
// ...

const Uuid = s.define('Uuid', (value) => isUuid.v4(value));

export const PostSavedProduct = s.object({
  productId: Uuid,
});
```

#### 3λ‹¨κ³„: `connect`λ¥Ό μ‚¬μ©ν•΄ κ΄€κ³„ μƒμ„±ν•κΈ°

μ΄μ  `app.js`μ— μ‹¤μ  λ΅μ§μ„ κµ¬ν„ν•©λ‹λ‹¤. νΉμ • μ μ € μ •λ³΄λ¥Ό **μμ •(`update`)** ν•μ—¬, `savedProducts` λ©λ΅μ— μƒλ΅μ΄ μƒν’μ„ **μ—°κ²°(`connect`)** ν•λ” λ°©μ‹μΌλ΅ μ ‘κ·Όν•©λ‹λ‹¤.

```javascript
// /app.js
// ...

app.post(
  '/users/:id/saved-products',
  asyncHandler(async (req, res) => {
    assert(req.body, PostSavedProduct);
    const { id: userId } = req.params; // νλΌλ―Έν„° idλ¥Ό userIdλ΅ μ΄λ¦„ λ³€κ²½
    const { productId } = req.body;

    const user = await prisma.user.update({
      where: { id: userId },
      data: {
        // savedProducts κ΄€κ³„ ν•„λ“μ— connect μµμ…μ„ μ‚¬μ©
        savedProducts: {
          connect: {
            id: productId, // idκ°€ productIdμΈ μƒν’κ³Ό μ—°κ²°
          },
        },
      },
      include: {
        savedProducts: true, // μ—…λ°μ΄νΈλ μ° λ©λ΅ μ „μ²΄λ¥Ό λ°ν™
      },
    });

    res.send(user.savedProducts);
  })
);
```

> **β¨ `connect`μ μ—­ν• **
>
> `connect: { id: productId }` μ½”λ“κ°€ μ‹¤ν–‰λλ©΄, Prismaλ” `User`μ™€ `Product` μ‚¬μ΄μ μ¨κ²¨μ§„ **μ •μ… ν…μ΄λΈ”(`_UserToProduct`)** μ— `userId`μ™€ `productId`λ¥Ό ν• μ¤„ μ¶”κ°€ν•μ—¬ λ‘ λ°μ΄ν„°μ κ΄€κ³„λ¥Ό λ§Ίμ–΄μ¤λ‹λ‹¤. μ°λ¦¬λ” λ³µμ΅ν• μ¤‘κ°„ κ³Όμ •μ„ μ‹ κ²½ μ“Έ ν•„μ” μ—†μ΄, λ‹¨μ§€ 'μ—°κ²°ν•λΌ'κ³  λ…λ Ήλ§ λ‚΄λ¦¬λ©΄ λ©λ‹λ‹¤.

#### 4λ‹¨κ³„: ν…μ¤νΈ λ° κ²°κ³Ό ν™•μΈ

APIλ¥Ό ν…μ¤νΈν•΄ λ³΄λ©΄, κΈ°μ΅΄ μ° λ©λ΅μ— μƒλ΅μ΄ μƒν’μ΄ μ¶”κ°€λμ–΄ μ΄ 5κ°μ μƒν’ λ©λ΅μ΄ λ°ν™λλ” κ²ƒμ„ ν™•μΈν•  μ μμµλ‹λ‹¤.

---

### 2. κ΄€κ³„ μ—°κ²° ν•΄μ ν•κΈ° (`disconnect`)

μ°ν•κΈ°λ¥Ό μ·¨μ†ν•λ” κΈ°λ¥μ€ `connect`μ λ°λ€μΈ **`disconnect`** λ¥Ό μ‚¬μ©ν•λ©΄ κ°„λ‹¨ν•κ² κµ¬ν„ν•  μ μμµλ‹λ‹¤. 'μ°'μ΄λΌλ” κ΄€κ³„λ¥Ό μ‚­μ ν•λ” κ²ƒμ΄λ―€λ΅, `DELETE` HTTP λ©”μ†λ“λ¥Ό μ‚¬μ©ν•λ” κ²ƒμ΄ RESTful API μ„¤κ³„μ— μ ν•©ν•©λ‹λ‹¤.

**μ—”λ“ν¬μΈνΈ**: `DELETE /users/:userId/saved-products/:productId`

```javascript
// /app.js

app.delete(
  '/users/:userId/saved-products/:productId',
  asyncHandler(async (req, res) => {
    const { userId, productId } = req.params;

    await prisma.user.update({
      where: { id: userId },
      data: {
        // savedProducts κ΄€κ³„ ν•„λ“μ— disconnect μµμ…μ„ μ‚¬μ©
        savedProducts: {
          disconnect: {
            id: productId, // idκ°€ productIdμΈ μƒν’κ³Όμ μ—°κ²°μ„ ν•΄μ 
          },
        },
      },
    });

    res.sendStatus(204);
  })
);
```

`connect`μ™€ λ¬Έλ²•μ€ λ™μΌν•μ§€λ§, `disconnect`λ” μ •μ… ν…μ΄λΈ”μ—μ„ ν•΄λ‹Ήν•λ” `userId`μ™€ `productId` ν–‰μ„ μ°Ύμ•„ **μ‚­μ **ν•μ—¬ λ‘ λ°μ΄ν„°μ κ΄€κ³„λ¥Ό λμ–΄μ¤λ‹λ‹¤.

Prismaμ `connect`μ™€ `disconnect`λ¥Ό ν™μ©ν•λ©΄, λ‹¤λ€λ‹¤ κ΄€κ³„λ¥Ό λ§μΉ κ°„λ‹¨ν• λ©λ΅μ— μ•„μ΄ν…μ„ μ¶”κ°€ν•κ³  μ κ±°ν•λ” κ²ƒμ²λΌ μ§κ΄€μ μΌλ΅ λ‹¤λ£° μ μμµλ‹λ‹¤.
