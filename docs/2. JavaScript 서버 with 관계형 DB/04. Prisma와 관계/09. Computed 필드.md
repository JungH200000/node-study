## ğŸ”¢ ë°ì´í„° ê°€ê³µí•˜ê¸°: ê³„ì‚°ëœ í•„ë“œ(Computed Field) ì¶”ê°€í•˜ê¸°

ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ì¡°íšŒí•œ ë°ì´í„°ë¥¼ ê·¸ëŒ€ë¡œ ë°˜í™˜í•  ë•Œë„ ìˆì§€ë§Œ, ì¢…ì¢… ì—¬ëŸ¬ í•„ë“œì˜ ê°’ì„ ì¡°í•©í•˜ì—¬ **ê³„ì‚°ëœ ìƒˆë¡œìš´ ê°’ì„ ì¶”ê°€**í•´ì„œ ë³´ë‚´ì¤˜ì•¼ í•  ë•Œê°€ ìˆìŠµë‹ˆë‹¤.

ì˜ˆë¥¼ ë“¤ì–´, íŠ¹ì • ì£¼ë¬¸(`Order`)ì˜ ìƒì„¸ ë‚´ì—­ì„ ì¡°íšŒí•  ë•Œ, ê° ì£¼ë¬¸ ìƒí’ˆ(`OrderItem`)ë“¤ì˜ ê°€ê²©ê³¼ ìˆ˜ëŸ‰ì„ ë°”íƒ•ìœ¼ë¡œ **ì£¼ë¬¸ ì´ì•¡**ì„ ê³„ì‚°í•´ì„œ í•¨ê»˜ ë³´ì—¬ì£¼ëŠ” ê²½ìš°ì…ë‹ˆë‹¤. ì´ë ‡ê²Œ ê¸°ì¡´ ë°ì´í„°ë¥¼ ë°”íƒ•ìœ¼ë¡œ ë™ì ìœ¼ë¡œ ê³„ì‚°ë˜ëŠ” í•„ë“œë¥¼ **ê³„ì‚°ëœ í•„ë“œ(Computed Field)** ë¼ê³  ë¶€ë¦…ë‹ˆë‹¤.

### 1ë‹¨ê³„: ê³„ì‚°ì— í•„ìš”í•œ ë°ì´í„° í•¨ê»˜ ì¡°íšŒí•˜ê¸°

ì£¼ë¬¸ ì´ì•¡ì„ ê³„ì‚°í•˜ë ¤ë©´, ë¨¼ì € íŠ¹ì • `Order`ì— ì†í•œ ëª¨ë“  `OrderItem`ë“¤ì˜ ì •ë³´ê°€ í•„ìš”í•©ë‹ˆë‹¤. `GET /orders/:id` ë¼ìš°íŠ¸ì—ì„œ `include` ì˜µì…˜ì„ ì‚¬ìš©í•˜ì—¬ `orderItems`ë¥¼ í•¨ê»˜ ì¡°íšŒí•©ë‹ˆë‹¤.

```javascript
// /app.js
app.get(
  '/orders/:id',
  asyncHandler(async (req, res) => {
    const { id } = req.params;
    const order = await prisma.order.findUniqueOrThrow({
      where: { id },
      include: {
        orderItems: true, // ì£¼ë¬¸ ìƒí’ˆë“¤ì„ í•¨ê»˜ ì¡°íšŒ
      },
    });

    // ... (ê³„ì‚° ë¡œì§ ì¶”ê°€ ì˜ˆì •)
  })
);
```

### # 2ë‹¨ê³„: ê³„ì‚° ë¡œì§ êµ¬í˜„í•˜ê¸°

PrismaëŠ” ì¡°íšŒ ê²°ê³¼ë¥¼ ì¼ë°˜ì ì¸ JavaScript ê°ì²´(ë˜ëŠ” ê°ì²´ì˜ ë°°ì—´)ë¡œ ë°˜í™˜í•˜ê¸° ë•Œë¬¸ì—, ì‘ë‹µì„ ë³´ë‚´ê¸° ì „ì— ììœ ë¡­ê²Œ ë°ì´í„°ë¥¼ ê°€ê³µí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. `order.orderItems` ë°°ì—´ì„ ìˆœíšŒí•˜ë©° ì´ì•¡ì„ ê³„ì‚°í•´ ë³´ê² ìŠµë‹ˆë‹¤.

#### **ë°©ë²• 1: `forEach` ë°˜ë³µë¬¸ ì‚¬ìš© (ì§ê´€ì ì¸ ë°©ë²•)**

```javascript
let total = 0;
order.orderItems.forEach((item) => {
  total += item.unitPrice * item.quantity;
});
```

#### **ë°©ë²• 2: `reduce` ë©”ì†Œë“œ ì‚¬ìš© (ê°„ê²°í•˜ê³  í•¨ìˆ˜í˜•ì¸ ë°©ë²•)**

ë°°ì—´ì˜ `reduce` ë©”ì†Œë“œë¥¼ ì‚¬ìš©í•˜ë©´ ì—¬ëŸ¬ ê°’ì„ í•˜ë‚˜ì˜ ê²°ê³¼ê°’ìœ¼ë¡œ ê¹”ë”í•˜ê²Œ ì¤„ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```javascript
const total = order.orderItems.reduce((sum, item) => {
  return sum + item.unitPrice * item.quantity;
}, 0); // 0ì€ sumì˜ ì´ˆê¸°ê°’
```

ë‘ ë°©ë²• ëª¨ë‘ ê²°ê³¼ëŠ” ë™ì¼í•˜ë©°, `reduce` ë°©ì‹ì´ ë” ê°„ê²°í•˜ì—¬ ìµœì‹  JavaScriptì—ì„œ ì„ í˜¸ë˜ëŠ” ê²½í–¥ì´ ìˆìŠµë‹ˆë‹¤.

---

### âœ… ìµœì¢… ì½”ë“œ ë° ê²°ê³¼ í™•ì¸

ê³„ì‚°ëœ `total` ê°’ì„ `order` ê°ì²´ì— ìƒˆë¡œìš´ ì†ì„±ìœ¼ë¡œ ì¶”ê°€í•œ ë’¤, í´ë¼ì´ì–¸íŠ¸ì— ì‘ë‹µìœ¼ë¡œ ë³´ëƒ…ë‹ˆë‹¤.

```javascript
// /app.js
app.get(
  '/orders/:id',
  asyncHandler(async (req, res) => {
    const { id } = req.params;
    const order = await prisma.order.findUniqueOrThrow({
      where: { id },
      include: {
        orderItems: true,
      },
    });

    // 1. forEach ì‚¬ìš©í•´ ì£¼ë¬¸ ì´ì•¡(total) ê³„ì‚°
    let total = 0;
    order.orderItems.forEach((orderItem) => {
      total += orderItem.unitPrice * orderItem.quantity;
    });

    // 2. ì¡°íšŒëœ order ê°ì²´ì— total í•„ë“œë¥¼ ì¶”ê°€
    order.total = total;

    // 3. ê³„ì‚°ëœ í•„ë“œê°€ í¬í•¨ëœ ìµœì¢… ê°ì²´ë¥¼ ì‘ë‹µìœ¼ë¡œ ì „ì†¡
    res.send(order);
  })
);
```

**[API í…ŒìŠ¤íŠ¸]**
`GET http://localhost:3000/orders/dedd2a7f-56c4-45b7-a37d-efdc1d2f518d`

**[ì‘ë‹µ ê²°ê³¼]**
ì´ì œ ì‘ë‹µ ê°ì²´ì˜ ë§¨ ë§ˆì§€ë§‰ì— `total` í•„ë“œê°€ ì„±ê³µì ìœ¼ë¡œ ì¶”ê°€ëœ ê²ƒì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```json
{
  "id": "dedd2a7f-56c4-45b7-a37d-efdc1d2f518d",
  "status": "PENDING",
  // ...
  "orderItems": [
    {
      "id": "f753a259-1e26-4ed9-9e60-099a4a06af4f",
      "unitPrice": 320000,
      "quantity": 1
      // ...
    }
    // ...
  ],
  "total": 847000 // âœ¨ ê³„ì‚°ëœ í•„ë“œ ì¶”ê°€ ì™„ë£Œ!
}
```
