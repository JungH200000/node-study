## 🗂️ 서버의 파일 제공하기: `express.static` 활용법

Express 서버는 기본적으로 우리가 `app.get()` 등으로 명확하게 정의한 경로(route)로만 요청을 받을 수 있습니다. 따라서 `multer`를 이용해 서버의 `uploads` 폴더에 파일을 성공적으로 업로드했더라도, 이 파일에 직접 접근할 수 있는 경로는 아직 존재하지 않습니다.

이번에는 **`express.static`** 내장 미들웨어를 사용해, 서버에 저장된 파일을 클라이언트가 URL로 접근하여 볼 수 있도록 만들어 보겠습니다.

---

### `express.static`으로 정적 파일 제공하기

서버를 운영하다 보면, 사용자가 업로드한 파일이나 서버에 미리 저장해 둔 이미지, CSS, JavaScript 파일 등을 제공해야 할 일이 많습니다. `express.static`은 바로 이런 **정적 파일(Static Files)** 들을 제공하는 역할을 합니다.

> **비유로 이해하기: 공용 자료실 열기 📂**
>
> `express.static`은 특정 폴더를 외부 손님(클라이언트)들이 자유롭게 파일을 가져갈 수 있는 **'공용 자료실'** 로 지정하는 것과 같습니다.
>
> ```javascript
> // 'uploads' 폴더를 공용 자료실로 지정합니다.
> app.use(express.static('uploads'));
> ```
>
> 이렇게 설정하면, Express는 `uploads` 폴더 안에 있는 파일들에 대해 자동으로 접근 경로를 열어줍니다. 예를 들어 `uploads/abc.png` 파일이 있다면, 이제 클라이언트는 `http://localhost:3000/abc.png`라는 주소로 이 파일에 직접 접근할 수 있게 됩니다.

#### URL 경로에 접두사(Prefix) 추가하기

자료실 입구에 `'files'`라는 간판을 달아주는 것처럼, URL에 특정 경로 접두사를 추가할 수도 있습니다. 이렇게 하면 파일 경로를 더 체계적으로 관리할 수 있습니다.

```javascript
// '/files'라는 간판을 달아줍니다.
app.use('/files', express.static('uploads'));
```

이제 `uploads/abc.png` 파일은 `http://localhost:3000/files/abc.png` 주소로 접근해야 합니다.

---

### 파일 업로드와 연동하기

여기서 한 가지 문제가 있습니다. `multer`는 파일명을 `6fd3ff...` 와 같은 무작위 문자열로 저장하기 때문에, 사용자는 자신이 방금 업로드한 파일의 정확한 URL을 알 수 없습니다.

따라서 가장 좋은 방법은, **파일 업로드가 성공했을 때 서버가 "업로드가 완료되었고, 이 파일은 앞으로 이 주소에서 찾을 수 있습니다."라고 응답해 주는 것**입니다.

`req.file` 객체에 담긴 파일 정보를 활용하여 이 기능을 구현해 보겠습니다.

```javascript
// src/app.js
import express from 'express';
import multer from 'multer';

const app = express();
const PORT = 3000;

// Multer 설정: 'uploads' 폴더에 파일을 저장
const upload = multer({ dest: 'uploads/' });

// Static 미들웨어 등록: '/files' 경로를 'uploads' 폴더와 연결
app.use('/files', express.static('uploads'));

// 파일 업로드를 위한 POST 라우트
app.post('/files', upload.single('attachment'), (req, res) => {
  // req.file 객체에서 서버에 저장된 파일명을 가져옵니다.
  const filename = req.file.filename;

  // static 미들웨어에 설정한 경로 접두사와 파일명을 조합하여
  // 클라이언트가 파일에 접근할 수 있는 전체 경로를 생성합니다.
  const path = `/files/${filename}`;

  // 생성된 경로를 클라이언트에게 JSON 형태로 응답합니다.
  res.json({ path: path });
});

app.listen(PORT, () => {
  console.log(`🚀 Server started on port ${PORT}`);
});
```

---

### 전체 흐름 테스트

1.  **파일 업로드 요청 (`POST`)**
    `POST http://localhost:3000/files`로 `hello.txt` 파일을 업로드합니다.

2.  **경로 응답 확인**
    서버는 업로드를 처리한 뒤, 파일에 접근할 수 있는 경로를 JSON으로 응답합니다.

    ```json
    {
      "path": "/files/e8c98a2630ea37f73714127aebf2d6e9"
    }
    ```

3.  **업로드된 파일 조회 (`GET`)**
    방금 응답으로 받은 경로를 사용해 `GET` 요청을 보냅니다.
    `GET http://localhost:3000/files/e8c98a2630ea37f73714127aebf2d6e9`

4.  **파일 내용 확인**
    요청에 대한 응답으로 업로드했던 `hello.txt` 파일의 내용(`Hello!`)을 확인할 수 있습니다.

이제 사용자는 서버 폴더를 직접 보지 않고도, 파일 업로드 후 받은 응답만으로 자신이 올린 파일에 정확하게 접근할 수 있게 되었습니다.
