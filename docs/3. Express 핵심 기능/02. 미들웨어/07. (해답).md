## 내가 작성한 답안

```js
// /node03-express-core-features
// /src/app.js
import express from 'express';

const app = express();
const PORT = 3000;

const products = {
  1: {
    name: 'MacBook Pro',
    price: 2500000,
    reviews: [
      { id: 1, user: '민준', rating: 5 },
      { id: 2, user: '서연', rating: 4 },
    ],
  },
  2: {
    name: 'Logitech Mx Keys',
    price: 120000,
    reviews: [
      { id: 3, user: '지후', rating: 5 },
      { id: 4, user: '하윤', rating: 3 },
    ],
  },
};

function getProduct(req, res, next) {
  const { id } = req.params;
  const product = products[id];

  if (!product) {
    return res.status(404).json({ message: '존재하지 않는 상품입니다.' });
    // return을 사용하지 않으면 오류가 발생해도 아래 코드의 next(); 가 실행되면서 다음 미들웨어로 넘어가게 되고,
    // 다음 미들웨어가 또 응답을 보내려고 하면 오류가 발생
    // Error: Can't set headers after they are sent to the client
  }

  req.product = product;
  return next();
}

app.get('/products/:id', getProduct, (req, res, next) => {
  res.json({ product: req.product });
});

app.get('/products/:id/reviews', getProduct, (req, res, next) => {
  res.json({ reviews: req.product.reviews });
});

app.listen(PORT, () => {
  console.log(`🚀 Server started on port ${PORT}`);
});
```

## 모범 답안

```js
import express from 'express';

const app = express();

const products = {
  1: {
    name: 'MacBook Pro',
    price: 2500000,
    reviews: [
      { id: 1, user: '민준', rating: 5 },
      { id: 2, user: '서연', rating: 4 },
    ],
  },
  2: {
    name: 'Logitech MX Keys',
    price: 120000,
    reviews: [
      { id: 3, user: '지후', rating: 5 },
      { id: 4, user: '하윤', rating: 3 },
    ],
  },
};

function getProduct(req, res, next) {
  req.product = products[req.params.id];
  if (req.product) {
    next();
  } else {
    res.status(404).json({ message: '존재하지 않는 상품입니다.' });
  }
}

app.get('/products/:id', getProduct, (req, res, next) => {
  res.json(req.product);
});

app.get('/products/:id/reviews', getProduct, (req, res, next) => {
  res.json(req.product.reviews);
});

app.listen(3000, () => {
  console.log('Server is listening on port 3000');
});
```
