## ë‚´ê°€ ìž‘ì„±í•œ ë‹µì•ˆ

```js
// /node03-express-core-features
// /src/app.js
import express from 'express';

const app = express();
const PORT = 3000;

const products = {
  1: {
    name: 'MacBook Pro',
    price: 2500000,
    reviews: [
      { id: 1, user: 'ë¯¼ì¤€', rating: 5 },
      { id: 2, user: 'ì„œì—°', rating: 4 },
    ],
  },
  2: {
    name: 'Logitech Mx Keys',
    price: 120000,
    reviews: [
      { id: 3, user: 'ì§€í›„', rating: 5 },
      { id: 4, user: 'í•˜ìœ¤', rating: 3 },
    ],
  },
};

function getProduct(req, res, next) {
  const { id } = req.params;
  const product = products[id];

  if (!product) {
    return res.status(404).json({ message: 'ì¡´ìž¬í•˜ì§€ ì•ŠëŠ” ìƒí’ˆìž…ë‹ˆë‹¤.' });
    // returnì„ ì‚¬ìš©í•˜ì§€ ì•Šìœ¼ë©´ ì˜¤ë¥˜ê°€ ë°œìƒí•´ë„ ì•„ëž˜ ì½”ë“œì˜ next(); ê°€ ì‹¤í–‰ë˜ë©´ì„œ ë‹¤ìŒ ë¯¸ë“¤ì›¨ì–´ë¡œ ë„˜ì–´ê°€ê²Œ ë˜ê³ ,
    // ë‹¤ìŒ ë¯¸ë“¤ì›¨ì–´ê°€ ë˜ ì‘ë‹µì„ ë³´ë‚´ë ¤ê³  í•˜ë©´ ì˜¤ë¥˜ê°€ ë°œìƒ
    // Error: Can't set headers after they are sent to the client
  }

  req.product = product;
  return next();
}

app.get('/products/:id', getProduct, (req, res, next) => {
  res.json({ product: req.product });
});

app.get('/products/:id/reviews', getProduct, (req, res, next) => {
  res.json({ reviews: req.product.reviews });
});

app.listen(PORT, () => {
  console.log(`ðŸš€ Server started on port ${PORT}`);
});
```

## ëª¨ë²” ë‹µì•ˆ

```js
import express from 'express';

const app = express();

const products = {
  1: {
    name: 'MacBook Pro',
    price: 2500000,
    reviews: [
      { id: 1, user: 'ë¯¼ì¤€', rating: 5 },
      { id: 2, user: 'ì„œì—°', rating: 4 },
    ],
  },
  2: {
    name: 'Logitech MX Keys',
    price: 120000,
    reviews: [
      { id: 3, user: 'ì§€í›„', rating: 5 },
      { id: 4, user: 'í•˜ìœ¤', rating: 3 },
    ],
  },
};

function getProduct(req, res, next) {
  req.product = products[req.params.id];
  if (req.product) {
    next();
  } else {
    res.status(404).json({ message: 'ì¡´ìž¬í•˜ì§€ ì•ŠëŠ” ìƒí’ˆìž…ë‹ˆë‹¤.' });
  }
}

app.get('/products/:id', getProduct, (req, res, next) => {
  res.json(req.product);
});

app.get('/products/:id/reviews', getProduct, (req, res, next) => {
  res.json(req.product.reviews);
});

app.listen(3000, () => {
  console.log('Server is listening on port 3000');
});
```
