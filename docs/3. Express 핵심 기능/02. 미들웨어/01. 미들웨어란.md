## 🤔 Express의 핵심, 미들웨어(Middleware)란?

Express 웹 서버의 가장 기본적인 동작은 클라이언트로부터 **요청(Request)** 을 받고, 정해진 작업을 수행한 뒤 **응답(Response)** 을 보내주는 것입니다. 이때 **미들웨어(Middleware)** 는 이 요청과 응답 사이클의 '중간(middle)'에 위치하여 다양한 역할을 수행하는 함수를 의미합니다.

마치 고속도로의 '톨게이트'나 건물의 '보안 검색대'처럼, 서버로 들어오는 모든 요청은 하나 이상의 미들웨어를 거치게 됩니다. 이 미들웨어는 들어온 요청을 검사하고, 필요한 처리를 한 뒤, 다음 미들웨어로 요청을 넘기거나 혹은 직접 클라이언트에게 응답을 보내며 사이클을 종료할 수 있습니다.

> Express로 하는 거의 모든 작업은 미들웨어를 통해 이루어집니다. 이 때문에 **"Express는 미들웨어의 집합이다"** 라고 말하기도 합니다. Express의 핵심 원리를 이해하려면 미들웨어를 반드시 알아야 합니다.

---

### 가장 가까운 미들웨어: 라우트 핸들러

사실 우리는 이미 미들웨어를 사용하고 있었습니다. 바로 라우트(Route)에 전달했던 콜백 함수입니다. 기존 프로젝트 코드를 다시 한번 살펴볼까요?

```javascript
// src/app.js
import express from 'express';

const app = express();
const PORT = 3000;

// GET 메서드로 최상위 경로('/')에 요청이 들어오면
// 두 번째 인자로 전달된 콜백 함수가 실행됩니다.
app.get('/', (req, res) => {
  res.json({ message: '안녕, 반가워요!' });
});

app.listen(PORT, () => {
  console.log(`🚀 Server started on port ${PORT}`);
});
```

위 코드에서 `app.get()` 메서드의 두 번째 인자로 전달된 화살표 함수 `(req, res) => { ... }`가 바로 미들웨어의 한 종류입니다. 이 함수는 클라이언트의 **요청(`req`)** 을 받아 **응답(`res`)** 을 되돌려주는, 미들웨어의 가장 기본적인 역할을 수행하고 있습니다.

이처럼 특정 경로(Route)의 요청을 처리(Handling)하는 미들웨어를 특별히 **요청 핸들러(Request Handler)** 또는 **라우트 핸들러(Route Handler)** 라고 부릅니다.

---

### 함수 분리를 통한 재사용성 높이기

요청 핸들러는 위의 예시처럼 익명 함수(이름이 없는 함수) 형태로 바로 전달할 수도 있지만, 아래와 같이 이름이 있는 함수로 분리하여 전달할 수도 있습니다.

```javascript
// src/app.js
import express from 'express';

const app = express();
const PORT = 3000;

// 'greeting'이라는 이름의 함수로 요청 핸들러를 분리
function greeting(req, res) {
  res.json({ message: '안녕하세요, 반가워요!' });
}

// 최상위 경로('/')의 GET 요청을 'greeting' 함수가 처리하도록 연결
app.get('/', greeting);

app.listen(PORT, () => {
  console.log(`🚀 Server started on port ${PORT}`);
});
```

코드를 이렇게 함수로 분리하면 어떤 장점이 있을까요?

바로 **코드의 재사용성**이 높아집니다. 만약 여러 다른 경로에서 동일한 응답을 보내야 할 경우, `greeting` 함수를 여러 라우트에 재사용하기만 하면 됩니다. 이는 코드 중복을 줄여주고 유지보수를 훨씬 쉽게 만들어 줍니다.
