## 🧩 서드파티 미들웨어: Express에 날개 달아주기

Express는 그 자체로 매우 가볍고 핵심적인 기능만 제공하는 '미니멀리즘' 철학을 가진 프레임워크입니다. 따라서 실제 웹 서버를 만들다 보면 로그 기록, 쿠키 파싱, 파일 업로드 등 추가적인 기능들이 필요해집니다.

다행히 우리는 이 모든 것을 직접 만들 필요가 없습니다. 전 세계의 수많은 개발자가 만들어 놓은 유용한 미들웨어들이 존재하기 때문입니다. 이를 **서드파티 미들웨어(Third-party Middleware)** 라고 부르며, 마치 스마트폰에 앱을 설치하듯 `npm`을 통해 간단하게 설치하고 연결하여 Express 서버의 기능을 무한히 확장할 수 있습니다.

가장 대표적이고 널리 쓰이는 서드파티 미들웨어들을 살펴보겠습니다.

---

### 1. `cookie-parser`

클라이언트가 보낸 쿠키(Cookie)를 손쉽게 다룰 수 있는 객체(`req.cookies`)로 변환해주는 '쿠키 번역기'입니다.

#### `cookie-parser`가 없다면?

이 미들웨어 없이는, `req.headers.cookie`를 통해 쿠키에 접근해야 하며, 그 결과는 `taste=chocolate; user=guest`와 같은 알아보기 힘든 문자열 형태입니다.

```javascript
// src/app.js
import express from 'express';

const app = express();
const PORT = 3000;

app.get('/cookies', (req, res) => {
  // 쿠키가 하나의 긴 문자열로 들어옵니다.
  console.log(req.headers.cookie);
  return res.json({ message: 'Cookie 확인!' });
});

app.listen(PORT, () => {
  console.log(`🚀 Server started on port ${PORT}`);
});
```

**요청:**

```http
GET http://localhost:3000/cookies
Cookie: `taste=chocolate
```

**터미널 결과:** `taste=chocolate`

#### `cookie-parser` 적용 후

먼저 `npm`으로 패키지를 설치합니다.

```bash
npm install cookie-parser
```

이제 미들웨어를 연결하면, `req.cookies`라는 편리한 객체를 통해 쿠키 값에 바로 접근할 수 있습니다.

```javascript
// src/app.js
import express from 'express';
import cookieParser from 'cookie-parser'; // 1. import

const app = express();
const PORT = 3000;

app.use(cookieParser()); // 2. 미들웨어 연결

app.get('/cookies', (req, res) => {
  // 이제 req.cookies 객체를 통해 쿠키를 쉽게 다룰 수 있습니다.
  console.log(req.cookies);
  return res.json({ cookies: req.cookies });
});

app.listen(PORT, () => {
  console.log(`🚀 Server started on port ${PORT}`);
});
```

**요청:**

```http
GET http://localhost:3000/cookies
Cookie: `taste=chocolate
```

**터미널 결과:** `{ taste: 'chocolate' }`

- [cookie-parser 공식 문서 (GitHub)](https://github.com/expressjs/cookie-parser)

---

### 2. `morgan`

서버로 들어오는 모든 요청에 대한 로그(log)를 자동으로 기록해주는 '서버 활동 기록관'입니다. 어떤 요청이, 언제, 어떻게 들어와서 어떤 응답을 받았는지 등을 터미널에 예쁘게 출력해주어 디버깅에 매우 유용합니다.

```bash
npm install morgan
```

`morgan()` 함수에 `'tiny'`, `'dev'` 같은 포맷 옵션을 전달하여 로그의 상세 수준을 조절할 수 있습니다.

```javascript
// src/app.js
import express from 'express';
import morgan from 'morgan'; // 1. import

const app = express();
const PORT = 3000;

// 'tiny' 포맷으로 요청 로그를 기록합니다.
app.use(morgan('tiny')); // 2. 미들웨어 연결

app.get('/hello', (req, res) => {
  return res.json({ message: '안녕하세요, 반가워요.' });
});

app.listen(PORT, () => {
  console.log(`🚀 Server started on port ${PORT}`);
});
```

**요청:** `GET http://localhost:3000/hello`
**터미널 결과:** `GET /hello 200 44 - 1.695 ms`
(메서드, 경로, 상태 코드, 응답 크기, 응답 시간 순)

- [morgan 공식 문서 (GitHub)](https://github.com/expressjs/morgan)

---

### 3. `cors`

**CORS(Cross-Origin Resource Sharing)** 는 웹 보안 정책 중 하나로, 한 웹사이트(`http://a.com`)가 다른 출처(`http://b.com`)의 리소스(API 등)에 접근하는 것을 통제합니다. `cors` 미들웨어는 이 복잡한 CORS 정책을 서버에서 쉽게 설정할 수 있도록 도와주는 '출입 정책 관리자'입니다.

```bash
npm install cors
```

가장 기본적인 사용법은 `app.use(cors())`를 호출하는 것으로, 모든 출처에서의 요청을 허용하게 됩니다. (실제 서비스에서는 보안을 위해 특정 출처만 허용하도록 옵션을 설정하는 것이 좋습니다.)

```javascript
// src/app.js
import express from 'express';
import cors from 'cors'; // 1. import

const app = express();
const PORT = 3000;

app.use(cors()); // 2. 모든 출처의 요청을 허용하는 미들웨어 연결

app.get('/hello', (req, res) => {
  return res.json({ message: 'CORS is enabled!' });
});

app.listen(PORT, () => {
  console.log(`🚀 Server started on port ${PORT}`);
});
```

- [cors 공식 문서 (GitHub)](https://github.com/expressjs/)
- cors 정리 문서 : [CORS 설정하기](<../../1. JavaScript 백엔드 개발 시작하기/12. 배포하기/12-2. CORS 설정하기.md>)

---

### 4. `multer`

HTML `<form>`을 통해 파일(이미지, 문서 등)을 업로드할 때 사용되는 `multipart/form-data` 형식의 요청을 처리하는 '파일 업로드 전문가'입니다.

파일 업로드는 다소 복잡한 주제이므로, 나중에 더 자세히 다룰 예정입니다. 지금은 "파일을 다룰 땐 `multer`라는 미들웨어를 쓰는구나\!" 정도로만 기억해 주세요.

```bash
npm install multer
```

```javascript
// src/app.js
import express from 'express';
import multer from 'multer'; // 1. import

const app = express();
const PORT = 3000;

// 'uploads/' 폴더에 파일을 저장하도록 설정
const upload = multer({ dest: 'uploads/' });

// 'avatar'라는 이름의 필드로 단일 파일 업로드를 처리하는 미들웨어
app.post('/profile', upload.single('avatar'), function (req, res, next) {
  // req.file에 업로드된 파일 정보가, req.body에 텍스트 필드 정보가 담깁니다.
  res.json({ file: req.file, body: req.body });
});

app.listen(PORT, () => {
  console.log(`🚀 Server started on port ${PORT}`);
});
```

- [multer 공식 문서 (GitHub)](https://github.com/expressjs/multer)
