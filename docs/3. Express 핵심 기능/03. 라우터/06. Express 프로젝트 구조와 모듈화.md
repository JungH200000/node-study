## 📦 Express 프로젝트 구조와 모듈화: 깔끔하게 정리 정돈하기

지금까지 우리는 `app.js`라는 단 하나의 파일 안에서 모든 코드를 작성해왔습니다. 하지만 프로젝트가 커질수록 `app.js` 파일은 점점 길고 복잡해져서 관리하기 어려워집니다.

이번에는 이렇게 한곳에 모여있던 코드를 기능에 따라 별도의 파일로 분리하여, 더 직관적이고 관리하기 좋은 구조로 만들어 보겠습니다. 이 과정을 **모듈화(Modularization)** 라고 합니다.

> Express는 정해진 프로젝트 구조를 강요하지 않는 유연한 프레임워크입니다. 따라서 지금부터 소개하는 구조가 유일한 정답은 아니며, 가장 널리 쓰이는 보편적인 패턴 중 하나라고 이해하시면 좋습니다.

---

### 시작점: 모든 것이 담긴 `app.js`

먼저 리팩토링을 시작할 현재의 코드 구조를 살펴보겠습니다. `app` 레벨 미들웨어, `productRouter`, `userRouter` 등 모든 코드가 `app.js` 파일 하나에 모여 있습니다.

```javascript
// src/app.js (리팩토링 전)
import express from 'express';

const app = express();
const PORT = 3000;

// 1. 애플리케이션 레벨 미들웨어
app.use((req, res, next) => {
  console.log('나는 항상 실행!');
  next();
});

// 2. Product 관련 라우터
const productRouter = express.Router();
productRouter.use((req, res, next) => {
  console.log('Product Router에서 항상 실행!');
  next();
});
productRouter
  .route('/')
  .get((req, res) => {
    res.json({ message: 'Product 목록 보기' });
  })
  .post((req, res) => {
    res.json({ message: 'Product 추가하기' });
  });

productRouter
  .route('/:id')
  .patch((req, res) => {
    res.json({ message: 'Product 수정하기' });
  })
  .delete((req, res) => {
    res.json({ message: 'Product 삭제하기' });
  });

// 3. User 관련 라우터
const userRouter = express.Router();
userRouter.get('/', (req, res, next) => {
  res.json({ message: 'User 목록 보기' });
});
// 4. 라우터들을 앱에 연결
app.use('/products', productRouter);
app.use('/users', userRouter);

// 5. 서버 실행
app.listen(PORT, () => {
  console.log(`🚀 Server started on port ${PORT}`);
});
```

---

### 1단계: 라우터 분리하기 (feat. `routes` 폴더)

가장 먼저, 각기 다른 주제를 다루는 라우터들을 별도의 파일로 분리해 보겠습니다. 마치 책상 위 책들을 주제별로 나눠 **책장(`routes` 폴더)** 에 꽂는 것과 같습니다.

1.  `src` 폴더 아래에 `routes` 폴더를 생성합니다.
2.  `routes` 폴더 안에 `products.router.js`와 `users.router.js` 파일을 만듭니다.
3.  `app.js`에 있던 각 라우터 코드를 잘라내어 해당 파일로 옮겨줍니다.

**`src/routes/products.router.js`**

```javascript
import express from 'express';

const router = express.Router(); // productRouter -> router로 이름 변경 (더 일반적)

// Product 라우터 레벨 미들웨어
router.use((req, res, next) => {
  console.log('Product Router에서 항상 실행!');
  next();
});

// Product 관련 API들
router.route('/').get(/*...*/).post(/*...*/);
router.route('/:id').patch(/*...*/).delete(/*...*/);

// 이 라우터 모듈을 외부에서 사용할 수 있도록 export 합니다.
export default router;
```

**`src/routes/users.router.js`**

```javascript
import express from 'express';

const router = express.Router();

// User 관련 API
router.get('/', (req, res) => {
  res.json({ message: 'User 목록 보기' });
});

// 이 라우터 모듈을 외부에서 사용할 수 있도록 export 합니다.
export default router;
```

> **💡 `export default`란?**
> ES 모듈 문법으로, "이 파일의 대표적인 기능은 바로 이 `router` 객체입니다"라고 외부에 알려주는 역할을 합니다. 이렇게 `export`된 모듈은 다른 파일에서 `import`하여 사용할 수 있습니다.

---

### 2단계: 미들웨어 분리하기 (feat. `middlewares` 폴더)

이제 공통적으로 사용되는 미들웨어를 분리해 보겠습니다. 여러 곳에서 쓰이는 연장들을 **도구 상자(`middlewares` 폴더)** 에 정리하는 것과 같습니다.

1.  `src` 폴더 아래에 `middlewares` 폴더를 생성합니다.
2.  `middlewares` 폴더 안에 `log.middleware.js` 파일을 만듭니다.
3.  `app.js`에 있던 애플리케이션 레벨 미들웨어 코드를 옮겨줍니다.

**`src/middlewares/log.middleware.js`**

```javascript
// 미들웨어는 그 자체로 함수입니다.
function logMiddleware(req, res, next) {
  console.log('나는 항상 실행!');
  next();
}

// 함수를 export 합니다.
export default logMiddleware;
```

---

### 최종 결과: 깔끔해진 `app.js`

이제 `app.js`는 어질러진 방이 아닌, 잘 정리된 '거실'의 역할을 합니다. 각 기능(라우터, 미들웨어)을 `import`로 가져와 조립하기만 하면 됩니다.

**`src/app.js` (리팩토링 후)**

```javascript
import express from 'express';
// 1. 분리된 모듈들을 가져옵니다(import).
import productRouter from './routes/products.router.js';
import userRouter from './routes/users.router.js';
import logMiddleware from './middlewares/log.middleware.js';

const app = express();
const PORT = 3000;

// 2. 미들웨어를 등록합니다.
app.use(logMiddleware);

// 3. 라우터를 등록합니다.
app.use('/products', productRouter);
app.use('/users', userRouter);

// 4. 서버를 실행합니다.
app.listen(PORT, () => {
  console.log(`🚀 Server started on port ${PORT}`);
});
```

이제 프로젝트의 구조는 아래와 같이 훨씬 더 명확해졌습니다.

```
src/
├── middlewares/
│   └── log.middleware.js  (공통 미들웨어)
├── routes/
│   ├── products.router.js (상품 API)
│   └── users.router.js    (사용자 API)
└── app.js                 (메인 조립 파일)
```
