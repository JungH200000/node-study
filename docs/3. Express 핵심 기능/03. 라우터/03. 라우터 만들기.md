## 🏛️ Express 라우터(Router)로 코드 모듈화하기

이전 글에서 `app.route()`를 사용해 반복되는 경로를 깔끔하게 정리해 보았습니다. 하지만 여전히 한계는 남아있습니다. 애플리케이션이 커져서 상품(products), 사용자(users), 주문(orders) 등 다뤄야 할 주제가 늘어날수록, 모든 라우트 코드가 `app.js`라는 단 하나의 파일에 계속 쌓이게 됩니다.

파일 하나가 수백, 수천 줄이 된다면 코드를 관리하기가 매우 힘들어지겠죠? Express는 이런 문제를 해결하기 위해 **`express.Router()`** 라는 강력한 기능을 제공합니다.

---

### `express.Router()`: 나만의 미니 Express 앱 만들기

`Router`는 이름 그대로 **'경로를 관리하는 관리자'** 입니다. 관련된 라우트들을 하나의 그룹으로 묶어, 독립적인 미니 앱(mini-app)처럼 관리할 수 있게 해줍니다.

`app.js`가 도시의 '시청'이라면, `Router`는 '상품 관리 부서', '민원 부서'처럼 특정 주제의 업무만 전문적으로 처리하는 별도의 부서와 같습니다. 시청은 각 부서가 어떤 일을 하는지만 알고 연결만 해주면 되므로, 훨씬 더 체계적으로 도시(애플리케이션)를 운영할 수 있게 됩니다.

이제 상품 관련 라우트들을 `productRouter`라는 별도의 부서로 분리해 보겠습니다.

#### 1단계: 라우터 생성 및 기존 코드 이전

먼저 `express.Router()`를 호출해 새로운 라우터 객체를 만들고, 기존에 `app` 객체에 붙어있던 라우트들을 그대로 새로운 라우터 객체로 옮겨줍니다.

```javascript
// src/app.js
import express from 'express';

const app = express(); // 🏢 시청(app)
const PORT = 3000;

// 1. '상품 관리 부서'에 해당하는 새로운 Router 객체를 생성합니다.
const productRouter = express.Router();

// 2. 기존에 app(시청)에서 하던 일을 productRouter(상품 관리 부서)로 옮깁니다.
//    app.route(...) -> productRouter.route(...)
productRouter
  .route('/products')
  .get((req, res) => {
    res.json({ message: 'Product 목록 보기' });
  })
  .post((req, res) => {
    res.json({ message: 'Product 추가하기' });
  });

productRouter
  .route('/products/:id')
  .patch((req, res) => {
    res.json({ message: 'Product 수정하기' });
  })
  .delete((req, res) => {
    res.json({ message: 'Product 삭제하기' });
  });

// 3. 생성한 productRouter(상품 관리 부서)를 app(시청)에 등록합니다.
//    이제 app은 productRouter가 어떤 경로들을 처리하는지 알게 됩니다.
app.use(productRouter);

app.listen(PORT, () => {
  console.log(`🚀 Server started on port ${PORT}`);
});
```

이제 API를 테스트해 보면 이전과 완벽하게 동일하게 동작하는 것을 확인할 수 있습니다. 코드가 분리되었지만, 기능은 그대로 유지됩니다.

---

### 심화: `app.use()`로 경로 접두사(Path Prefix) 추가하기

라우터를 사용하면 여기서 한 단계 더 나아가 코드를 더욱 간결하게 만들 수 있습니다. `app.use()`에 **경로 접두사**를 추가하는 방법입니다.

"앞으로 `'/products'`로 시작하는 모든 요청은 `productRouter`에게 전달해 주세요"라고 시청(`app`)에 미리 알려주는 것과 같습니다.

```javascript
// src/app.js
import express from 'express';

const app = express();
const PORT = 3000;

const productRouter = express.Router();

// 이제 productRouter는 '/products'라는 기본 경로를 부여받았으므로,
// 내부에서는 그 뒷부분 경로만 신경 쓰면 됩니다.
// '/products' -> '/'
productRouter
  .route('/')
  .get((req, res) => {
    res.json({ message: 'Product 목록 보기' });
  })
  .post((req, res) => {
    res.json({ message: 'Product 추가하기' });
  });

// '/products/:id' -> '/:id'
productRouter
  .route('/:id')
  .patch((req, res) => {
    res.json({ message: 'Product 수정하기' });
  })
  .delete((req, res) => {
    res.json({ message: 'Product 삭제하기' });
  });

// '/products' 경로로 들어오는 모든 요청을 productRouter가 처리하도록 연결
app.use('/products', productRouter);

app.listen(PORT, () => {
  console.log(`🚀 Server started on port ${PORT}`);
});
```

라우터 내부에서는 더 이상 `'/products'`라는 중복 경로를 신경 쓸 필요가 없어졌습니다. 훨씬 더 깔끔하죠? 이 방식은 라우터가 자신의 주제에만 집중할 수 있도록 도와줍니다.

실제 프로젝트에서는 이렇게 분리된 `productRouter`를 `routes/products.router.js`와 같은 별도의 파일로 만들어 관리하게 됩니다. (파일 분리는 나중에 더 자세히 알아보겠습니다.)
