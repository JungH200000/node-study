## ë‚´ê°€ ìž‘ì„±í•œ ë‹µì•ˆ

```js
// /node03-express-core-features
// /src/app.js
import express from 'express';

const app = express();
const PORT = 3000;

// Product
const productRouter = express.Router();

productRouter.use((req, res, next) => {
  console.log('ì—¬ê¸°ëŠ” Product Router ìž…ë‹ˆë‹¤.');
  next();
});

productRouter
  .route('/')
  .get((req, res, next) => {
    res.json({ message: 'ìƒí’ˆ ëª©ë¡ ë³´ê¸°' });
  })
  .post((req, res, next) => {
    res.json({ message: 'ìƒí’ˆ ì¶”ê°€í•˜ê¸°' });
  });
productRouter
  .route('/:id')
  .patch((req, res, next) => {
    res.json({ message: 'ìƒí’ˆ ìˆ˜ì •í•˜ê¸°' });
  })
  .delete((req, res, next) => {
    res.json({ message: 'ìƒí’ˆ ì‚­ì œí•˜ê¸°' });
  });

app.use('/products', productRouter);

// User
const userRouter = express.Router();

userRouter.use((req, res, next) => {
  //console.log(req.headers); => ë¨¼ì € ì‹¤í–‰í•´ë³´ê¸°
  const auth = req.headers.authorization;
  //console.log(auth);

  if (auth === 's3cret') {
    next();
  } else {
    console.error(`ì¸ì¦ ì‹¤íŒ¨: ì „ë‹¬ë°›ì€ 'Authorization'ì€ ${auth}`);
    res.status(401).json({ message: 'ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.' });
  }
});

userRouter
  .route('/')
  .get((req, res, next) => {
    res.json({ message: 'ì‚¬ìš©ìž ëª©ë¡ ë³´ê¸°' });
  })
  .post((req, res, next) => {
    res.json({ message: 'ì‚¬ìš©ìž ì¶”ê°€í•˜ê¸°' });
  });
userRouter
  .route('/:id')
  .patch((req, res, next) => {
    res.json({ message: 'ì‚¬ìš©ìž ìˆ˜ì •í•˜ê¸°' });
  })
  .delete((req, res, next) => {
    res.json({ message: 'ì‚¬ìš©ìž ì‚­ì œí•˜ê¸°' });
  });

app.use('/users', userRouter);

app.listen(PORT, () => {
  console.log(`ðŸš€ Server started on port ${PORT}`);
});
```

## ëª¨ë²” ë‹µì•ˆ

```js
import express from 'express';

const app = express();

// User Router
const userRouter = express.Router();

userRouter
  .route('/')
  .get((req, res, next) => {
    res.json({ message: 'ì‚¬ìš©ìž ëª©ë¡ ë³´ê¸°' });
  })
  .post((req, res, next) => {
    res.json({ message: 'ì‚¬ìš©ìž ì¶”ê°€í•˜ê¸°' });
  });

userRouter
  .route('/:id')
  .patch((req, res, next) => {
    res.json({ message: 'ì‚¬ìš©ìž ìˆ˜ì •í•˜ê¸°' });
  })
  .delete((req, res, next) => {
    res.json({ message: 'ì‚¬ìš©ìž ì‚­ì œí•˜ê¸°' });
  });

function adminOnly(req, res, next) {
  const authorization = req.get('Authorization');
  /* ë¦¬í€˜ìŠ¤íŠ¸ì˜ í—¤ë”ì—ì„œ íŠ¹ì • í•„ë“œ ì´ë¦„ìœ¼ë¡œ ê°’ì„ ê°€ì ¸ì˜¤ê¸° ìœ„í•´ì„œëŠ”
   * req.get(HEADER_FIELD) ë©”ì†Œë“œë¥¼ ì‚¬ìš©í•˜ë©´ ë©ë‹ˆë‹¤.
   * í•´ë‹¹ ë©”ì†Œë“œë¡œ ê°€ì ¸ì˜¨ ê°’ì„ ë³€ìˆ˜ì— ì €ìž¥í•˜ë„ë¡ í• ê²Œìš”. */
  if (authorization === 's3cret') {
    next();
  } else {
    res.status(401).json({ message: 'ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.' });
  }
}

app.use('/users', adminOnly, userRouter);

// Product Router
const productRouter = express.Router();

productRouter
  .route('/')
  .get((req, res, next) => {
    res.json({ message: 'ìƒí’ˆ ëª©ë¡ ë³´ê¸°' });
  })
  .post((req, res, next) => {
    res.json({ message: 'ìƒí’ˆ ì¶”ê°€í•˜ê¸°' });
  });

productRouter
  .route('/:id')
  .patch((req, res, next) => {
    res.json({ message: 'ìƒí’ˆ ìˆ˜ì •í•˜ê¸°' });
  })
  .delete((req, res, next) => {
    res.json({ message: 'ìƒí’ˆ ì‚­ì œí•˜ê¸°' });
  });

app.use('/products', productRouter);

app.listen(3000, () => {
  console.log('Server is listening on port 3000');
});
```
