## API 응답에 '사용 설명서'를 담는 법: 자기 서술적 메시지

클라이언트와 서버가 주고받는 메시지는 결국 '문자열 데이터' 덩어리입니다. 사람은 응답으로 온 `{ "name": "Chung" }`이라는 JSON을 보고 "아, 이름이 Chung이구나"라고 의미를 해석할 수 있지만, 컴퓨터(클라이언트)에게는 그저 정해진 형식의 문자열일 뿐, `name`이 '이름'을 의미하는지는 알 수 없습니다.

마치 우리가 모르는 외국어 문장을 볼 때, 글자라는 것은 알지만 그 뜻은 이해하지 못하는 것과 같죠.

이 문제를 해결하기 위해 REST 아키텍처는 **'자기 서술적 메시지(Self-descriptive Messages)'** 라는 중요한 원칙을 제시합니다.

> **자기 서술적 메시지란?**
>
> 메시지를 받는 쪽(클라이언트)이 **메시지 자체만 보고도 그 내용과 의미를 온전히 해석하고 처리할 수 있어야 한다**는 원칙입니다. 즉, 메시지 안에 일종의 '사용 설명서'가 포함되어야 한다는 뜻입니다.

이 원칙을 지키기 위한 두 가지 방법을 알아보겠습니다.

---

### 방법 1: 미디어 타입(Media Type)으로 설명하기

#### **기본 설명: `Content-Type` 헤더**

HTTP 요청과 응답 헤더에는 `Content-Type`이라는 필드가 있습니다. 이 필드는 메시지 본문(Body)에 담긴 콘텐츠가 어떤 종류의 데이터인지를 알려주는 역할을 합니다.

예를 들어, `Content-Type`의 값으로 사용되는 **미디어 타입(Media Type)** 이 `text/html`이면 '이 메시지는 HTML 문서입니다', `application/json`이면 '이 메시지는 JSON 형식입니다'라고 알려주는 식이죠.

하지만 `application/json`이라는 정보만으로는 부족합니다. 이는 데이터의 **구조(Syntax)** 가 JSON이라는 것만 알려줄 뿐, 데이터 필드 하나하나의 **의미(Semantics)** 까지 설명해주지는 못하기 때문입니다.

#### **심화 설명: 의미까지 담은 커스텀 미디어 타입**

이 원칙을 완벽하게 지키려면, 우리는 `application/json`을 넘어 우리 서비스에 맞는 새로운 미디어 타입을 직접 정의해야 합니다. 예를 들어, `application/vnd.my-api.user+json`처럼요.

그리고 이 새로운 미디어 타입은 `user`라는 자원의 `name` 필드가 '사용자의 이름'을, `age` 필드가 '나이'를 의미한다는 세부적인 내용까지 정의하고 있어야 합니다. 클라이언트는 이 미디어 타입 정보를 보고 메시지의 의미를 정확하게 해석할 수 있게 됩니다.

---

### 방법 2: 링크 헤더(Link Header)로 안내하기

새로운 미디어 타입을 정의하고 등록하는 것은 현실적으로 매우 복잡한 과정입니다. 그래서 더 실용적인 대안으로 **`Link` 헤더**를 사용하는 방법이 있습니다.

`Link` 헤더에 `rel="profile"` 속성과 함께 이 메시지를 어떻게 해석하면 되는지 알려주는 **API 명세 문서의 주소**를 담아 보내는 것입니다.

- **`Link` 헤더 예시**

  ```http
  HTTP/1.1 200 OK
  Content-Type: application/json
  Link: <https://api.example.com/docs/profiles/user>; rel="profile"

  {
    "id": 1,
    "username": "chung"
  }
  ```

위 예시에서 클라이언트는 `Link` 헤더에 있는 주소로 찾아가 `username`이 무엇을 의미하는지, 어떤 형식을 갖는지 등의 정보를 파악하여 메시지를 완벽하게 이해할 수 있습니다.

---

### 🤔 현실의 벽: 왜 잘 지켜지지 않을까?

사실 이 '자기 서술적 메시지' 원칙은 REST의 제약 조건 중 **현실에서 가장 잘 지켜지지 않는 것**으로 꼽힙니다.

HTML은 `<article>`, `<h1>`처럼 태그 자체에 의미가 담겨있어 이 원칙을 만족하기 쉽습니다. 하지만 JSON 기반의 API에서는 커스텀 미디어 타입을 정의하거나 `Link` 헤더를 일일이 추가하는 데 드는 비용이 크기 때문입니다.

대부분의 API는 `Content-Type: application/json`만 명시하고, 메시지의 세부적인 의미는 개발자가 API 문서를 직접 찾아보도록 하는 방식으로 타협하는 경우가 많습니다.

---

### ✍️ 핵심 요약

- **자기 서술적 메시지**는 클라이언트가 메시지만 보고도 그 의미를 완전히 이해할 수 있어야 한다는 REST 원칙입니다.
- 이를 지키는 방법으로는 **(1) 의미까지 정의된 커스텀 미디어 타입을 사용**하거나, **(2) `Link` 헤더에 API 문서 주소를 첨부**하는 방법이 있습니다.
- 단순히 `Content-Type: application/json`만 사용하는 것은 데이터의 '구조'만 알려줄 뿐, '의미'까지 설명하지는 못합니다.
- 하지만 구현의 복잡성 때문에, 이 원칙은 실제 API 설계 시 가장 자주 타협되거나 생략되는 경향이 있습니다.
- ***

### 📚 참고 자료

더 깊이 있는 정보가 필요하다면 아래 문서들을 참고해 보세요.

- [MDN 문서 - MIME 타입 (IANA 미디어 타입)](https://developer.mozilla.org/ko/docs/Web/HTTP/Guides/MIME_types)
- [MDN 문서 - Link header](https://developer.mozilla.org/en-US/docs/Web/HTTP/Reference/Headers/Link)
