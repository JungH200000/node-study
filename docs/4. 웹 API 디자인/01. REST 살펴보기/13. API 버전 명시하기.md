## API도 성장통을 겪는다: 안전하게 API 변경하고 버전 관리하기 🌱

소프트웨어는 살아있는 생물과 같습니다. 한 번 만들고 끝나는 것이 아니라, 새로운 기능이 추가되고 기존 기능이 개선되거나 삭제되면서 끊임없이 변화하고 성장하죠. 웹 API도 예외는 아닙니다.

하지만 이미 많은 사용자가 이용하고 있는 API를 함부로 변경할 수는 없습니다. 아무런 예고 없이 API의 구조나 주소를 바꿔버리면, 이를 사용하던 클라이언트들은 갑자기 오류를 겪게 될 테니까요.

그렇다면 어떻게 기존 사용자에게 영향을 주지 않고 안전하게 API를 변경할 수 있을까요? 변경 사항의 규모를 두 가지로 나누어 살펴보겠습니다.

---

### 변경 사항의 두 종류: 사소한 변경 vs. 중대한 변경

#### **1. 사소한 변경 (Non-Breaking Change) 다루기**

기존의 기능을 망가뜨리지 않는 변경입니다. 가장 흔한 예는 **응답(Response)에 새로운 필드를 추가**하는 것입니다.

이런 경우에는 기존의 구조를 그대로 유지한 채 새로운 필드만 추가합니다. 기존 클라이언트는 새로 생긴 필드를 무시하고 예전처럼 동작할 것이고, 새로운 기능이 필요한 클라이언트는 이 필드를 사용하면 됩니다. 이처럼 하위 호환성을 지키는 변경은 비교적 간단하게 적용할 수 있습니다.

#### **2. 중대한 변경 (Breaking Change) 다루기**

기존의 기능을 망가뜨리는 변경입니다. 예를 들어 **응답 필드의 이름이나 자료형을 바꾸거나, 특정 필드를 삭제**하는 경우가 해당됩니다. 이런 변경을 'Breaking Change'라고 부릅니다.

이런 중대한 변경 사항을 적용할 때는, 기존 API는 그대로 둔 채 **완전히 새로운 버전의 API 엔드포인트를 만드는 것**이 안전하고 편리합니다. 그리고 기존 사용자들이 새로운 버전으로 충분히 옮겨갈 시간을 번 후에, 이전 버전의 API를 비활성화하는 것이죠.

이때, 새로운 버전의 API라는 것을 명확히 알려주기 위해 **버저닝(Versioning)** 이라는 방법을 사용합니다.

---

### API 버저닝(Versioning)이란? 🏷️

버저닝은 말 그대로 API 주소에 `v1`, `v2` 와 같은 **버전 정보**를 붙여 관리하는 것입니다. 이를 통해 어떤 자원을 가리키는지 명확하게 유지하면서도, 변경된 API와 기존 API를 명확히 구분할 수 있습니다.

예를 들어, `/members` API에 중대한 변경이 필요할 때, `/brand-new-members` 와 같이 완전히 새로운 주소를 만드는 것보다 아래와 같이 버전을 명시하는 것이 훨씬 더 직관적입니다.

```
# 기존 멤버 API
GET /v1/members

# 중대한 변경이 적용된 새로운 멤버 API
GET /v2/members
```

### 버전을 표현하는 3가지 방법

API 버전을 클라이언트에게 알리는 방법에는 주로 세 가지가 사용됩니다.

#### **1. URI 경로에 포함**

가장 직관적이고 널리 쓰이는 방법입니다. URI 경로의 일부로 버전을 포함합니다.

```http
GET /v2/members
```

#### **2. 쿼리 파라미터(Query Parameter)에 포함**

URI는 그대로 두고, 쿼리 파라미터를 통해 버전을 명시합니다.

```http
GET /members?version=2
```

#### **3. 요청 헤더(Request Header)에 포함**

URI를 깔끔하게 유지하고 싶을 때 사용하는 방법입니다. `Accept` 나 커스텀 헤더를 통해 버전을 전달합니다.

```http
GET /members
Accept: application/vnd.my-api.v2+json
```

어떤 방식을 선택할지는 API의 특성과 팀의 개발 문화에 따라 달라집니다. 중요한 것은 **팀원들과 충분한 논의를 통해 일관된 방식을 정하고, 그 결정 사항을 API 문서에 명확하게 기록**하여 모두가 오해 없이 사용할 수 있도록 하는 것입니다.

---

### ✍️ 마무리하며

**API 버저닝**은 REST의 공식 제약 조건은 아닙니다. 하지만 끊임없이 변화하는 웹 환경 속에서 API의 안정성을 유지하고 유연하게 변경사항을 관리하기 위한 **필수적인 모범 사례(Best Practice)** 로 널리 인정받고 있습니다.

- **사소한 변경**은 하위 호환성을 유지하며 추가하고,
- **중대한 변경**은 반드시 **버저닝**을 통해 새로운 API를 만들어 대응해야 한다는 점을 기억해 주세요.

이를 통해 우리는 기존 사용자들을 보호하면서도, 새로운 기능과 개선을 지속적으로 제공하는 건강한 API를 만들어나갈 수 있습니다.
